# ClosetConnect ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜ ì´ì •ë¦¬

## ğŸ“‹ ëª©ì°¨

1. [ì‹œìŠ¤í…œ ê°œìš”](#ì‹œìŠ¤í…œ-ê°œìš”)
2. [ì „ì²´ ì•„í‚¤í…ì²˜](#ì „ì²´-ì•„í‚¤í…ì²˜)
3. [ì„œë¹„ìŠ¤ë³„ ìƒì„¸ ì„¤ì •](#ì„œë¹„ìŠ¤ë³„-ìƒì„¸-ì„¤ì •)
4. [ë°ì´í„° íë¦„](#ë°ì´í„°-íë¦„)
5. [ë°°í¬ í™˜ê²½](#ë°°í¬-í™˜ê²½)
6. [ë„¤íŠ¸ì›Œí¬ êµ¬ì„±](#ë„¤íŠ¸ì›Œí¬-êµ¬ì„±)
7. [ë³´ì•ˆ ì„¤ì •](#ë³´ì•ˆ-ì„¤ì •)
8. [ëª¨ë‹ˆí„°ë§ ë° ë¡œê¹…](#ëª¨ë‹ˆí„°ë§-ë°-ë¡œê¹…)

---

## ì‹œìŠ¤í…œ ê°œìš”

**ClosetConnect**ëŠ” AI ê¸°ë°˜ ì˜·ì¥ ê´€ë¦¬ ë° ê°€ìƒ í”¼íŒ… ì„œë¹„ìŠ¤ì…ë‹ˆë‹¤.

### í•µì‹¬ ê¸°ëŠ¥

1. **AI ì˜· ë¶„ì„**: ì—…ë¡œë“œí•œ ì˜· ì´ë¯¸ì§€ë¥¼ AIë¡œ ë¶„ì„í•˜ì—¬ ìë™ ë¶„ë¥˜
2. **ë°°ê²½ ì œê±° ë° ì„¸ê·¸ë©˜í…Œì´ì…˜**: ì˜· ì˜ì—­ë§Œ ì¶”ì¶œ
3. **ì´ë¯¸ì§€ ë³µì›**: ì˜ë¦° ë¶€ë¶„ì„ AIë¡œ ë³µì›
4. **ê°€ìƒ ì°©ìš© (Try-On)**: ì—¬ëŸ¬ ì˜·ì„ ì¡°í•©í•˜ì—¬ ê°€ìƒìœ¼ë¡œ ì°©ìš©
5. **ì»¤ë®¤ë‹ˆí‹°**: ì½”ë”” ê³µìœ  ë° ì†Œí†µ
6. **ë§ˆì¼“í”Œë ˆì´ìŠ¤**: ì¤‘ê³  ê±°ë˜
7. **ê²°ì œ ì‹œìŠ¤í…œ**: Toss Payments ì—°ë™

---

## ì „ì²´ ì•„í‚¤í…ì²˜

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        ì‚¬ìš©ì (ë¸Œë¼ìš°ì €)                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚ HTTPS
                       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     Vercel (Frontend)                            â”‚
â”‚  - React 18                                                      â”‚
â”‚  - TypeScript                                                    â”‚
â”‚  - Vite                                                          â”‚
â”‚  - SockJS/STOMP (WebSocket Client)                              â”‚
â”‚  - Axios (HTTP Client)                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚ HTTPS REST API / WebSocket
                       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  Railway (Backend - Spring Boot)                 â”‚
â”‚  - Java 17                                                       â”‚
â”‚  - Spring Boot 3.2.0                                             â”‚
â”‚  - Spring Security + JWT                                         â”‚
â”‚  - WebSocket (STOMP)                                             â”‚
â”‚  - RabbitMQ Client                                               â”‚
â”‚  - MariaDB (MySQL)                                               â”‚
â”‚  - Toss Payments API                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚                  â”‚
       â”‚ RabbitMQ AMQP   â”‚ TCP (MySQL)
       â”‚                  â”‚
       â–¼                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   RabbitMQ   â”‚   â”‚   MariaDB    â”‚
â”‚  (Railway)   â”‚   â”‚  (Railway)   â”‚
â”‚              â”‚   â”‚              â”‚
â”‚ - Message    â”‚   â”‚ - Users      â”‚
â”‚   Queue      â”‚   â”‚ - Clothes    â”‚
â”‚ - Pub/Sub    â”‚   â”‚ - Posts      â”‚
â”‚              â”‚   â”‚ - Orders     â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ AMQP (Public URL)
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              CloudRun Worker (AI Processing)                     â”‚
â”‚  - Python 3.11                                                   â”‚
â”‚  - RabbitMQ Consumer                                             â”‚
â”‚  - rembg (ë°°ê²½ ì œê±°)                                              â”‚
â”‚  - HTTP Client (API í˜¸ì¶œ)                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚                  â”‚
       â”‚ HTTPS            â”‚ HTTPS
       â”‚                  â”‚
       â–¼                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ CloudRun     â”‚   â”‚ CloudRun     â”‚   â”‚ CloudRun     â”‚
â”‚ Segmentation â”‚   â”‚ Inpainting   â”‚   â”‚ Try-On       â”‚
â”‚              â”‚   â”‚              â”‚   â”‚              â”‚
â”‚ - SegFormer  â”‚   â”‚ - Stable     â”‚   â”‚ - Gemini     â”‚
â”‚ - FastAPI    â”‚   â”‚   Diffusion  â”‚   â”‚ - Flask      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                              â”‚
                                              â”‚ HTTPS
                                              â–¼
                                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                    â”‚   Google AI      â”‚
                                    â”‚   Gemini API     â”‚
                                    â”‚                  â”‚
                                    â”‚ - Image          â”‚
                                    â”‚   Generation     â”‚
                                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ì„œë¹„ìŠ¤ë³„ ìƒì„¸ ì„¤ì •

### 1. Vercel (Frontend)

#### ê¸°ìˆ  ìŠ¤íƒ
- **Framework**: React 18 + TypeScript
- **Build Tool**: Vite
- **Styling**: CSS Modules / Styled Components
- **State Management**: Context API
- **WebSocket**: SockJS + STOMP
- **HTTP Client**: Axios

#### ë°°í¬ ì„¤ì •
```yaml
Framework Preset: Vite
Build Command: npm run build
Output Directory: dist
Install Command: npm install
Node Version: 18.x
```

#### í™˜ê²½ ë³€ìˆ˜
```bash
VITE_API_BASE_URL=https://your-railway-app.railway.app
VITE_WS_BASE_URL=https://your-railway-app.railway.app
```

#### ë„ë©”ì¸ ì„¤ì •
- **Production**: `your-app.vercel.app`
- **Custom Domain**: (ì„ íƒì ) `yourdomain.com`

#### íŠ¹ì§•
- âœ… **ìë™ ë°°í¬**: GitHub Push ì‹œ ìë™ ë°°í¬
- âœ… **Preview ë°°í¬**: PRë§ˆë‹¤ Preview URL ìƒì„±
- âœ… **CDN**: ì „ ì„¸ê³„ Edge Network
- âœ… **HTTPS**: ìë™ SSL ì¸ì¦ì„œ
- âœ… **Zero Config**: ì„¤ì • íŒŒì¼ ë¶ˆí•„ìš”

---

### 2. Railway (Backend)

#### 2-1. Spring Boot Service

##### ê¸°ìˆ  ìŠ¤íƒ
- **Language**: Java 17
- **Framework**: Spring Boot 3.2.0
- **Security**: Spring Security + JWT
- **Database**: MariaDB (JDBC)
- **WebSocket**: Spring WebSocket (STOMP)
- **Message Queue**: RabbitMQ (AMQP)
- **Payment**: Toss Payments API

##### ë°°í¬ ì„¤ì •
```yaml
Build Command: ./gradlew clean bootJar
Start Command: java -Xmx384m -Xms256m -XX:MaxMetaspaceSize=128m -jar build/libs/ClosetConnectProject-0.0.1-SNAPSHOT.jar
Port: 8080
```

##### í™˜ê²½ ë³€ìˆ˜
```bash
# Spring Profile
SPRING_PROFILES_ACTIVE=prod

# Database
DB_URL=jdbc:mariadb://${{MySQL.MYSQLHOST}}:${{MySQL.MYSQLPORT}}/${{MySQL.MYSQLDATABASE}}
DB_USERNAME=${{MySQL.MYSQLUSER}}
DB_PASSWORD=${{MySQL.MYSQLPASSWORD}}

# JWT
JWT_SECRET=your-very-long-random-secret-key
JWT_TOKEN_VALIDITY=3600

# RabbitMQ
RABBITMQ_ENABLED=true
SPRING_RABBITMQ_ADDRESSES=${{RabbitMQ.RABBITMQ_PRIVATE_URL}}

# CloudRun APIs
TRYON_API_URL=https://closetconnect-tryon-xxx.run.app
CLOTH_SEGMENTATION_SERVER_URL=https://closetconnect-segmentation-xxx.run.app
INPAINTING_SERVER_URL=https://closetconnect-inpainting-xxx.run.app

# Toss Payments
TOSS_CLIENT_KEY=test_gck_xxx
TOSS_SECRET_KEY=test_gsk_xxx

# File Upload
UPLOAD_DIR=./uploads

# Memory Optimization
JAVA_OPTS=-Xmx384m -Xms256m -XX:MaxMetaspaceSize=128m
```

##### CORS ì„¤ì •
```java
@Configuration
public class WebConfig {
    @Value("${cors.allowed-origins}")
    private String[] allowedOrigins;

    // Vercel ë„ë©”ì¸ í—ˆìš©
    // https://*.vercel.app
}
```

##### WebSocket ì„¤ì •
```java
@Configuration
@EnableWebSocketMessageBroker
public class WebSocketConfig {
    // STOMP over SockJS
    // Endpoint: /ws
    // Destinations: /topic/*, /queue/*
}
```

---

#### 2-2. MariaDB Service

##### ì„¤ì •
- **Engine**: MariaDB 10.11
- **Storage**: 1GB (Auto-scaling)
- **Backup**: ìë™ ë°±ì—… í™œì„±í™”

##### ë°ì´í„°ë² ì´ìŠ¤ ìŠ¤í‚¤ë§ˆ
```sql
-- ì£¼ìš” í…Œì´ë¸”
- users (ì‚¬ìš©ì)
- clothes (ì˜·)
- ootd (ì½”ë””)
- posts (ê²Œì‹œê¸€)
- comments (ëŒ“ê¸€)
- market_products (ìƒí’ˆ)
- orders (ì£¼ë¬¸)
- chat_messages (ì±„íŒ…)
```

##### ì—°ê²° ì •ë³´
```bash
MYSQLHOST=containers-us-west-xxx.railway.app
MYSQLPORT=6789
MYSQLDATABASE=railway
MYSQLUSER=root
MYSQLPASSWORD=xxx
```

---

#### 2-3. RabbitMQ Service

##### ì„¤ì •
- **Version**: RabbitMQ 3.12
- **Management UI**: í™œì„±í™”
- **Port**: 5672 (AMQP), 15672 (Management)

##### Exchange & Queue êµ¬ì¡°
```
Exchange: cloth.exchange (direct)
â”œâ”€ Queue: cloth.processing.queue
â”‚  â””â”€ Routing Key: cloth.processing
â”‚  â””â”€ Consumer: CloudRun Worker
â”œâ”€ Queue: cloth.result.queue
â”‚  â””â”€ Routing Key: cloth.result
â”‚  â””â”€ Consumer: Spring Boot
â””â”€ Queue: cloth.progress.queue
   â””â”€ Routing Key: cloth.progress
   â””â”€ Consumer: Spring Boot (WebSocket ì „ì†¡)
```

##### ë©”ì‹œì§€ íë¦„
```
1. Spring Boot â†’ RabbitMQ (cloth.processing.queue)
   - ì˜· ì—…ë¡œë“œ ì´ë²¤íŠ¸ ë°œí–‰

2. CloudRun Worker â†’ RabbitMQ êµ¬ë…
   - ë©”ì‹œì§€ ìˆ˜ì‹  ë° AI ì²˜ë¦¬

3. CloudRun Worker â†’ RabbitMQ (cloth.progress.queue)
   - ì§„í–‰ ìƒí™© ì—…ë°ì´íŠ¸ (10%, 25%, 50%, 75%, 95%)

4. CloudRun Worker â†’ RabbitMQ (cloth.result.queue)
   - ìµœì¢… ê²°ê³¼ ì „ì†¡

5. Spring Boot â†’ DB ì €ì¥ & WebSocket ì „ì†¡
   - ê²°ê³¼ ì €ì¥ ë° í´ë¼ì´ì–¸íŠ¸ì— ì•Œë¦¼
```

##### ì—°ê²° ì •ë³´
```bash
# Private URL (Railway ë‚´ë¶€)
RABBITMQ_PRIVATE_URL=amqp://user:pass@rabbitmq.railway.internal:5672

# Public URL (ì™¸ë¶€ ì ‘ê·¼ - CloudRun Worker ì‚¬ìš©)
RABBITMQ_URL=amqp://user:pass@xxx.proxy.rlwy.net:xxxxx
```

---

### 3. CloudRun (AI Services)

#### 3-1. CloudRun Worker (ë©”ì¸ ì²˜ë¦¬)

##### ê¸°ìˆ  ìŠ¤íƒ
- **Language**: Python 3.11
- **Dependencies**:
  - `rembg[cpu]` - ë°°ê²½ ì œê±°
  - `pika` - RabbitMQ í´ë¼ì´ì–¸íŠ¸
  - `requests` - HTTP í´ë¼ì´ì–¸íŠ¸
  - `google-generativeai` - Gemini API

##### ë°°í¬ ì„¤ì •
```yaml
Region: asia-northeast3 (Seoul)
Memory: 2 GiB
CPU: 1
Min Instances: 1 (í•­ìƒ ì‹¤í–‰)
Max Instances: 1
Timeout: 900s (15ë¶„)
Concurrency: 1
CPU Allocation: Always allocated
```

##### í™˜ê²½ ë³€ìˆ˜
```bash
RABBITMQ_HOST=xxx.proxy.rlwy.net
RABBITMQ_PORT=xxxxx
RABBITMQ_USERNAME=xxx
RABBITMQ_PASSWORD=xxx
SEGMENTATION_API_URL=https://closetconnect-segmentation-xxx.run.app
INPAINTING_API_URL=https://closetconnect-inpainting-xxx.run.app
GOOGLE_API_KEY=AIzaSyA...
```

##### ì²˜ë¦¬ íŒŒì´í”„ë¼ì¸
```
1. RabbitMQì—ì„œ ë©”ì‹œì§€ ìˆ˜ì‹  (ì˜· ì´ë¯¸ì§€ ì—…ë¡œë“œ)
   â””â”€ Progress: 0%

2. rembgë¡œ ë°°ê²½ ì œê±° (ë¡œì»¬)
   â””â”€ Progress: 25%
   â””â”€ Output: removed_bg.png

3. CloudRun Segmentation API í˜¸ì¶œ
   â””â”€ Progress: 50%
   â””â”€ Output: segmented.png (ì˜· ì˜ì—­ë§Œ í¬ë¡­)

4. Google Imagen APIë¡œ ì´ë¯¸ì§€ í™•ì¥ (ì„ íƒì )
   â””â”€ Progress: 70%
   â””â”€ Output: expanded.png

5. CloudRun Inpainting API í˜¸ì¶œ
   â””â”€ Progress: 95%
   â””â”€ Output: inpainted.png (ë³µì›ëœ ì´ë¯¸ì§€)

6. RabbitMQë¡œ ê²°ê³¼ ì „ì†¡
   â””â”€ Progress: 100%
```

---

#### 3-2. Segmentation API

##### ê¸°ìˆ  ìŠ¤íƒ
- **Framework**: FastAPI
- **Model**: SegFormer (Hugging Face)
  - `mattmdjaga/segformer_b2_clothes`
- **Device**: CPU

##### ì—”ë“œí¬ì¸íŠ¸
```
GET  /health
POST /segment
```

##### ë°°í¬ ì„¤ì •
```yaml
Region: asia-northeast3
Memory: 2 GiB
CPU: 2
Allow Unauthenticated: Yes
```

##### ê¸°ëŠ¥
- ì˜ë¥˜ ì„¸ê·¸ë©˜í…Œì´ì…˜ (18ê°œ í´ë˜ìŠ¤)
- ìƒì˜/í•˜ì˜/ì‹ ë°œ/ê°€ë°© ë“± ìë™ ê°ì§€
- ë°”ìš´ë”© ë°•ìŠ¤ ì¶”ì¶œ
- í¬ë¡­ ì´ë¯¸ì§€ ìƒì„±

---

#### 3-3. Inpainting API

##### ê¸°ìˆ  ìŠ¤íƒ
- **Framework**: FastAPI
- **Model**: Stable Diffusion Inpainting
- **Device**: CPU

##### ì—”ë“œí¬ì¸íŠ¸
```
GET  /health
POST /inpaint
```

##### ë°°í¬ ì„¤ì •
```yaml
Region: asia-northeast3
Memory: 2 GiB
CPU: 2
Timeout: 300s
Allow Unauthenticated: Yes
```

##### ê¸°ëŠ¥
- ì˜ë¦° ì˜· ì´ë¯¸ì§€ ë³µì›
- ìº”ë²„ìŠ¤ í™•ì¥ (extend_ratio)
- ìì—°ìŠ¤ëŸ¬ìš´ ì´ë¯¸ì§€ ìƒì„±

---

#### 3-4. Try-On API

##### ê¸°ìˆ  ìŠ¤íƒ
- **Framework**: Flask
- **Model**: Google Gemini 2.0 Flash
- **API**: Google AI Studio

##### ì—”ë“œí¬ì¸íŠ¸
```
GET  /health
POST /tryon
POST /tryon/url
```

##### ë°°í¬ ì„¤ì •
```yaml
Region: asia-northeast3
Memory: 2 GiB
CPU: 2
Timeout: 300s
Allow Unauthenticated: Yes
```

##### ê¸°ëŠ¥
- ì—¬ëŸ¬ ì˜· ì¡°í•© (ìƒì˜ + í•˜ì˜ + ì‹ ë°œ + ì•…ì„¸ì„œë¦¬)
- Gemini APIë¡œ ê°€ìƒ ì°©ìš© ì´ë¯¸ì§€ ìƒì„±
- Base64 ì´ë¯¸ì§€ ì…ì¶œë ¥

---

## ë°ì´í„° íë¦„

### 1. ì˜· ì—…ë¡œë“œ íë¦„

```
[ì‚¬ìš©ì] Vercel Frontend
   â†“ 1. ì´ë¯¸ì§€ ì„ íƒ & ì—…ë¡œë“œ ë²„íŠ¼ í´ë¦­
   â†“    POST /api/v1/clothes/upload (multipart/form-data)
   â†“
[Spring Boot] Railway Backend
   â†“ 2. ì›ë³¸ ì´ë¯¸ì§€ ì €ì¥ (/uploads/original/)
   â†“ 3. Cloth ì—”í‹°í‹° ìƒì„± (status: PROCESSING)
   â†“ 4. RabbitMQ ë©”ì‹œì§€ ë°œí–‰ (cloth.processing.queue)
   â†“    { clothId, userId, imageBytes, imageType }
   â†“
[RabbitMQ] Railway
   â†“ 5. ë©”ì‹œì§€ íì— ì €ì¥
   â†“
[CloudRun Worker]
   â†“ 6. ë©”ì‹œì§€ ìˆ˜ì‹  (Consumer)
   â†“ 7. ë°°ê²½ ì œê±° (rembg) â†’ Progress 25%
   â†“ 8. Segmentation API í˜¸ì¶œ â†’ Progress 50%
   â†“ 9. Imagen í™•ì¥ (ì„ íƒ) â†’ Progress 70%
   â†“ 10. Inpainting API í˜¸ì¶œ â†’ Progress 95%
   â†“ 11. RabbitMQë¡œ ê²°ê³¼ ì „ì†¡ (cloth.result.queue)
   â†“
[Spring Boot] Railway Backend
   â†“ 12. ê²°ê³¼ ìˆ˜ì‹  (Consumer)
   â†“ 13. DB ì—…ë°ì´íŠ¸
   â†“     - removed_bg_url
   â†“     - segmented_url
   â†“     - inpainted_url
   â†“     - suggested_category
   â†“     - status: READY_FOR_REVIEW
   â†“ 14. WebSocket ë©”ì‹œì§€ ì „ì†¡
   â†“     /queue/cloth/progress/{userId}
   â†“
[ì‚¬ìš©ì] Vercel Frontend
   â†“ 15. WebSocketìœ¼ë¡œ ì‹¤ì‹œê°„ ì§„í–‰ ìƒí™© ìˆ˜ì‹ 
   â†“ 16. ì²˜ë¦¬ ì™„ë£Œ ì‹œ ê²°ê³¼ ì´ë¯¸ì§€ í‘œì‹œ
   â””â”€ 17. ì¹´í…Œê³ ë¦¬ í™•ì¸ & ìµœì¢… ì´ë¯¸ì§€ ì„ íƒ
```

---

### 2. ê°€ìƒ ì°©ìš© (Try-On) íë¦„

```
[ì‚¬ìš©ì] Vercel Frontend
   â†“ 1. ì˜· ì—¬ëŸ¬ ê°œ ì„ íƒ (ìƒì˜, í•˜ì˜, ì‹ ë°œ ë“±)
   â†“ 2. "ê°€ìƒ ì°©ìš©" ë²„íŠ¼ í´ë¦­
   â†“    POST /api/v1/outfit/tryon
   â†“    { upperClothesId, lowerClothesId, shoesId, ... }
   â†“
[Spring Boot] Railway Backend
   â†“ 3. DBì—ì„œ ì˜· ì •ë³´ ì¡°íšŒ
   â†“ 4. ì´ë¯¸ì§€ íŒŒì¼ ë¡œë“œ (inpainted ìš°ì„ )
   â†“ 5. Base64 ì¸ì½”ë”©
   â†“ 6. CloudRun Try-On API í˜¸ì¶œ
   â†“    POST https://closetconnect-tryon-xxx.run.app/tryon
   â†“    { upperClothes: base64, lowerClothes: base64, ... }
   â†“
[CloudRun Try-On API]
   â†“ 7. Base64 ë””ì½”ë”©
   â†“ 8. Google Gemini API í˜¸ì¶œ
   â†“    - Prompt: "ì´ ì˜·ë“¤ì„ ì…ì€ ì‚¬ëŒì„ ìƒì„±í•´ì¤˜"
   â†“ 9. Geminiê°€ ê°€ìƒ ì°©ìš© ì´ë¯¸ì§€ ìƒì„±
   â†“ 10. Base64ë¡œ ë°˜í™˜
   â†“     { success: true, image: "data:image/png;base64,..." }
   â†“
[Spring Boot] Railway Backend
   â†“ 11. Base64 ë””ì½”ë”© ë° íŒŒì¼ ì €ì¥
   â†“     /uploads/tryon/tryon_{userId}_{timestamp}.png
   â†“ 12. í´ë¼ì´ì–¸íŠ¸ì— URL ë°˜í™˜
   â†“
[ì‚¬ìš©ì] Vercel Frontend
   â””â”€ 13. ê°€ìƒ ì°©ìš© ì´ë¯¸ì§€ í‘œì‹œ
```

---

### 3. WebSocket ì‹¤ì‹œê°„ í†µì‹ 

```
[Vercel Frontend]
   â†“ 1. SockJS ì—°ê²°
   â†“    new SockJS('https://railway-app.railway.app/ws')
   â†“ 2. STOMP ì—°ê²°
   â†“    stompClient.connect()
   â†“ 3. êµ¬ë…
   â†“    /queue/cloth/progress/{userId}
   â†“
[Spring Boot] WebSocket Server
   â†“ 4. ì—°ê²° ìˆ˜ë½
   â†“ 5. RabbitMQì—ì„œ ì§„í–‰ ìƒí™© ìˆ˜ì‹ 
   â†“ 6. WebSocketìœ¼ë¡œ ë¸Œë¡œë“œìºìŠ¤íŠ¸
   â†“    { clothId, status, currentStep, progressPercentage }
   â†“
[Vercel Frontend]
   â””â”€ 7. ì‹¤ì‹œê°„ UI ì—…ë°ì´íŠ¸
      - Progress Bar
      - í˜„ì¬ ë‹¨ê³„ í…ìŠ¤íŠ¸
      - ë¡œë”© ìŠ¤í”¼ë„ˆ
```

---

## ë°°í¬ í™˜ê²½

### ì¸í”„ë¼ ë¹„êµ

| í•­ëª© | Vercel | Railway | CloudRun |
|------|--------|---------|----------|
| **íƒ€ì…** | Static/SSR | Container | Container |
| **ìŠ¤ì¼€ì¼ë§** | ìë™ (ë¬´ì œí•œ) | ìˆ˜ë™ | ìë™ (0-N) |
| **ê°€ê²©** | Free (Hobby) | $5/ì›”~ | ì‚¬ìš©ëŸ‰ ê¸°ë°˜ |
| **ì§€ì—­** | Global CDN | US West | Asia Northeast3 |
| **ë°°í¬ ë°©ì‹** | Git Push | Git Push | Docker Image |
| **SSL** | ìë™ | ìë™ | ìë™ |
| **í™˜ê²½ ë³€ìˆ˜** | UI/CLI | UI/CLI | UI/CLI |
| **ë¡œê·¸** | Real-time | Real-time | Cloud Logging |

---

### ë¹„ìš© ì˜ˆìƒ (ì›”ê°„)

| ì„œë¹„ìŠ¤ | ì‚¬ì–‘ | ì˜ˆìƒ ë¹„ìš© |
|--------|------|----------|
| **Vercel** | Hobby Plan | $0 (ë¬´ë£Œ) |
| **Railway** | |  |
| â””â”€ Spring Boot | 512MB RAM | $5-10 |
| â””â”€ MariaDB | 1GB Storage | $2-5 |
| â””â”€ RabbitMQ | 256MB RAM | $2-3 |
| **CloudRun** | |  |
| â””â”€ Worker | 2GB, 1 CPU, Always On | $20-30 |
| â””â”€ Segmentation | 2GB, 2 CPU, On-demand | $5-10 |
| â””â”€ Inpainting | 2GB, 2 CPU, On-demand | $5-10 |
| â””â”€ Try-On | 2GB, 2 CPU, On-demand | $5-10 |
| **Google AI** | |  |
| â””â”€ Gemini API | Flash ëª¨ë¸ | $0-10 |
| **í•©ê³„** | | **$44-88/ì›”** |

> ğŸ’¡ **ë¹„ìš© ì ˆê° íŒ**:
> - CloudRun Workerì˜ min-instancesë¥¼ 0ìœ¼ë¡œ ì„¤ì • (ê°œë°œ í™˜ê²½)
> - Gemini API ë¬´ë£Œ í‹°ì–´ í™œìš©
> - Railwayì˜ Trial Credits ì‚¬ìš©

---

## ë„¤íŠ¸ì›Œí¬ êµ¬ì„±

### ë„ë©”ì¸ ë° ì—”ë“œí¬ì¸íŠ¸

```
Frontend:
  https://your-app.vercel.app

Backend API:
  https://your-railway-app.railway.app
  â”œâ”€ /api/v1/auth/*          (ì¸ì¦)
  â”œâ”€ /api/v1/users/*         (ì‚¬ìš©ì)
  â”œâ”€ /api/v1/clothes/*       (ì˜·)
  â”œâ”€ /api/v1/outfit/*        (Try-On)
  â”œâ”€ /api/v1/posts/*         (ê²Œì‹œê¸€)
  â”œâ”€ /api/v1/market/*        (ë§ˆì¼“)
  â””â”€ /ws                     (WebSocket)

CloudRun APIs:
  https://closetconnect-worker-xxx.run.app        (Worker, ì§ì ‘ í˜¸ì¶œ X)
  https://closetconnect-segmentation-xxx.run.app  (Segmentation)
  https://closetconnect-inpainting-xxx.run.app    (Inpainting)
  https://closetconnect-tryon-xxx.run.app         (Try-On)
```

---

### CORS ì„¤ì •

**Spring Boot (application-prod.properties)**
```java
@CrossOrigin(
    origins = {
        "https://*.vercel.app",
        "http://localhost:5173"
    },
    allowedHeaders = "*",
    allowCredentials = "true"
)
```

**CloudRun APIs (FastAPI/Flask)**
```python
app.add_middleware(
    CORSMiddleware,
    allow_origins=[
        "http://localhost:8080",
        "https://*.railway.app",
        "https://*.vercel.app"
    ],
    allow_credentials=True,
    allow_methods=["*"],
    allow_headers=["*"],
)
```

---

## ë³´ì•ˆ ì„¤ì •

### 1. ì¸ì¦ ë° ì¸ê°€

#### JWT ê¸°ë°˜ ì¸ì¦
```java
// Spring Security ì„¤ì •
- JWT í† í° ë°œê¸‰ (Access Token)
- ìœ íš¨ ê¸°ê°„: 1ì‹œê°„
- ì•”í˜¸í™”: HS256
- Secret Key: í™˜ê²½ ë³€ìˆ˜ë¡œ ê´€ë¦¬
```

#### ê¶Œí•œ ê´€ë¦¬
```java
// ì‚¬ìš©ì ê¶Œí•œ
- ROLE_USER: ì¼ë°˜ ì‚¬ìš©ì
- ROLE_ADMIN: ê´€ë¦¬ì

// API ì—”ë“œí¬ì¸íŠ¸ ë³´í˜¸
@PreAuthorize("hasRole('USER')")
@PreAuthorize("hasRole('ADMIN')")
```

---

### 2. í™˜ê²½ ë³€ìˆ˜ ë³´ì•ˆ

**ë¯¼ê° ì •ë³´ ê´€ë¦¬**
- âœ… DB ë¹„ë°€ë²ˆí˜¸: Railway í™˜ê²½ ë³€ìˆ˜
- âœ… JWT Secret: Railway í™˜ê²½ ë³€ìˆ˜
- âœ… Toss Secret Key: Railway í™˜ê²½ ë³€ìˆ˜
- âœ… Google API Key: CloudRun Secret Manager
- âœ… RabbitMQ ë¹„ë°€ë²ˆí˜¸: Railway í™˜ê²½ ë³€ìˆ˜

**ì ˆëŒ€ Gitì— ì»¤ë°‹í•˜ì§€ ì•ŠìŒ**
- `.env` íŒŒì¼
- `application-prod.properties` (í…œí”Œë¦¿ë§Œ)

---

### 3. HTTPS/TLS

- âœ… Vercel: ìë™ SSL (Let's Encrypt)
- âœ… Railway: ìë™ SSL
- âœ… CloudRun: ìë™ SSL (Google-managed)

---

### 4. API ë³´ì•ˆ

**Rate Limiting** (Spring Boot)
```java
// Bucket4j ì‚¬ìš©
@RateLimit(permits = 100, timeUnit = TimeUnit.MINUTES)
```

**Input Validation**
```java
// Spring Validation
@Valid @RequestBody CreateRequest request
```

---

## ëª¨ë‹ˆí„°ë§ ë° ë¡œê¹…

### 1. Vercel

**Analytics**
- Page Views
- Deployment Status
- Build Logs

**Logs**
```bash
# Vercel CLI
vercel logs
```

---

### 2. Railway

**Metrics**
- CPU Usage
- Memory Usage
- Network I/O
- Request Count

**Logs**
- Real-time Logs (Dashboard)
- Log Filtering
- Log Export

---

### 3. CloudRun

**Cloud Monitoring**
```
- Request Count
- Request Latency
- Instance Count
- Memory/CPU Usage
- Error Rate
```

**Cloud Logging**
```
- Application Logs
- Request Logs
- Error Logs
- Filter by Severity
```

**Alerts** (ì„ íƒì )
```
- Error Rate > 5%
- Memory Usage > 80%
- CPU Usage > 80%
```

---

## íŠ¸ëŸ¬ë¸”ìŠˆíŒ… ê°€ì´ë“œ

### 1. Frontend (Vercel)

**ë¬¸ì œ**: API í˜¸ì¶œ ì‹¤íŒ¨
```
í•´ê²°:
1. VITE_API_BASE_URL í™˜ê²½ ë³€ìˆ˜ í™•ì¸
2. CORS ì„¤ì • í™•ì¸ (Spring Boot)
3. Railway ì„œë¹„ìŠ¤ ìƒíƒœ í™•ì¸
```

**ë¬¸ì œ**: WebSocket ì—°ê²° ì‹¤íŒ¨
```
í•´ê²°:
1. SockJS fallback í™•ì¸
2. Railway WebSocket ì§€ì› í™•ì¸
3. CORS allowedOrigins í™•ì¸
```

---

### 2. Backend (Railway)

**ë¬¸ì œ**: ë©”ëª¨ë¦¬ ë¶€ì¡± (OOM)
```
í•´ê²°:
1. JAVA_OPTS ë©”ëª¨ë¦¬ ì„¤ì • ì¡°ì •
   -Xmx384m â†’ -Xmx512m
2. Railway Plan ì—…ê·¸ë ˆì´ë“œ
```

**ë¬¸ì œ**: RabbitMQ ì—°ê²° ì‹¤íŒ¨
```
í•´ê²°:
1. RABBITMQ_PRIVATE_URL í™•ì¸
2. RabbitMQ ì„œë¹„ìŠ¤ ìƒíƒœ í™•ì¸
3. Credentials í™•ì¸
```

---

### 3. CloudRun

**ë¬¸ì œ**: Workerê°€ ì¤‘ì§€ë¨
```
í•´ê²°:
1. min-instances = 1 ì„¤ì • í™•ì¸
2. "CPU is always allocated" í™•ì¸
```

**ë¬¸ì œ**: rembg ì˜¤ë¥˜
```
í•´ê²°:
1. requirements: rembg[cpu] í™•ì¸
2. onnxruntime ì„¤ì¹˜ í™•ì¸
```

---

## í–¥í›„ ê°œì„  ê³„íš

### ë‹¨ê¸° (1-3ê°œì›”)
- [ ] Redis ìºì‹± ì¶”ê°€ (ì˜· ëª©ë¡, ì‚¬ìš©ì ì •ë³´)
- [ ] S3/GCSë¡œ ì´ë¯¸ì§€ ìŠ¤í† ë¦¬ì§€ ì´ì „
- [ ] Prometheus + Grafana ëª¨ë‹ˆí„°ë§
- [ ] Sentry ì—ëŸ¬ íŠ¸ë˜í‚¹
- [ ] CI/CD íŒŒì´í”„ë¼ì¸ ê°œì„ 

### ì¤‘ê¸° (3-6ê°œì›”)
- [ ] Kubernetes ë§ˆì´ê·¸ë ˆì´ì…˜ (CloudRun â†’ GKE)
- [ ] Multi-region ë°°í¬ (ê¸€ë¡œë²Œ ì„œë¹„ìŠ¤)
- [ ] CDN ìµœì í™” (ì´ë¯¸ì§€ ì „ì†¡ ì†ë„)
- [ ] API Gateway ë„ì…
- [ ] Service Mesh (Istio)

### ì¥ê¸° (6-12ê°œì›”)
- [ ] AI ëª¨ë¸ ìì²´ í›ˆë ¨ ë° ìµœì í™”
- [ ] Real-time Try-On (ì›¹ìº  ì—°ë™)
- [ ] Mobile App (React Native)
- [ ] Microservices ì•„í‚¤í…ì²˜ ì „í™˜
- [ ] Multi-cloud (AWS, Azure ì¶”ê°€)

---

## ì°¸ê³  ë¬¸ì„œ

- [Vercel Documentation](https://vercel.com/docs)
- [Railway Documentation](https://docs.railway.app)
- [Google Cloud Run Documentation](https://cloud.google.com/run/docs)
- [Spring Boot Documentation](https://spring.io/projects/spring-boot)
- [RabbitMQ Documentation](https://www.rabbitmq.com/documentation.html)

---

**ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸**: 2026-01-08
**ì‘ì„±ì**: ClosetConnect Team
