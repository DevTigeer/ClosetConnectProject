<?xml version="1.0" encoding="UTF-8"?>
<svg width="1920" height="1080" viewBox="0 0 1920 1080" xmlns="http://www.w3.org/2000/svg">
  <defs>
    <linearGradient id="bgGradient" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" style="stop-color:#f8f9fa"/>
      <stop offset="100%" style="stop-color:#e9ecef"/>
    </linearGradient>
    <filter id="shadow" x="-20%" y="-20%" width="140%" height="140%">
      <feDropShadow dx="0" dy="4" stdDeviation="6" flood-color="#000" flood-opacity="0.1"/>
    </filter>
  </defs>

  <!-- Background -->
  <rect width="1920" height="1080" fill="url(#bgGradient)"/>

  <!-- Header -->
  <rect x="0" y="0" width="120" height="120" fill="#8DABC4"/>
  <text x="160" y="50" font-family="Arial, sans-serif" font-size="18" fill="#8DABC4" font-weight="bold">Part 3</text>
  <text x="160" y="90" font-family="Arial, sans-serif" font-size="36" fill="#2c3e50" font-weight="bold">운영: 장애 대응 &amp; 모니터링</text>

  <!-- Main content grid -->
  <!-- Reliability features -->
  <rect x="100" y="160" width="850" height="400" rx="15" fill="white" filter="url(#shadow)"/>
  <text x="525" y="205" font-family="Arial, sans-serif" font-size="22" fill="#2c3e50" text-anchor="middle" font-weight="bold">안정성 설계</text>

  <!-- Feature 1: Message Durability -->
  <rect x="140" y="240" width="770" height="100" rx="12" fill="#d4edda"/>
  <rect x="140" y="240" width="8" height="100" rx="4" fill="#28a745"/>
  <circle cx="200" y="290" r="25" fill="white"/>
  <text x="200" y="297" font-family="Arial, sans-serif" font-size="24" fill="#28a745" text-anchor="middle">✓</text>
  <text x="250" y="280" font-family="Arial, sans-serif" font-size="18" fill="#155724" font-weight="bold">메시지 내구성 (Durable Queue)</text>
  <text x="250" y="310" font-family="Arial, sans-serif" font-size="14" fill="#6c757d">RabbitMQ 큐를 Durable로 설정 → 브로커 재시작해도 메시지 유지</text>
  <text x="250" y="330" font-family="Arial, sans-serif" font-size="14" fill="#6c757d">Worker가 죽어도 큐에 메시지 남아있어 재처리 가능</text>

  <!-- Feature 2: Failure Handling -->
  <rect x="140" y="355" width="770" height="100" rx="12" fill="#d4edda"/>
  <rect x="140" y="355" width="8" height="100" rx="4" fill="#28a745"/>
  <circle cx="200" y="405" r="25" fill="white"/>
  <text x="200" y="412" font-family="Arial, sans-serif" font-size="24" fill="#28a745" text-anchor="middle">✓</text>
  <text x="250" y="395" font-family="Arial, sans-serif" font-size="18" fill="#155724" font-weight="bold">처리 실패 시 상태 마킹</text>
  <text x="250" y="425" font-family="Arial, sans-serif" font-size="14" fill="#6c757d">Cloth 상태를 FAILED로 마킹 → 실패 건만 따로 조회/재처리 가능</text>
  <text x="250" y="445" font-family="Arial, sans-serif" font-size="14" fill="#6c757d">전체 시스템 다운 없이 개별 처리 실패 격리</text>

  <!-- Feature 3: Timeout Prevention -->
  <rect x="140" y="470" width="770" height="80" rx="12" fill="#d4edda"/>
  <rect x="140" y="470" width="8" height="80" rx="4" fill="#28a745"/>
  <circle cx="200" y="510" r="25" fill="white"/>
  <text x="200" y="517" font-family="Arial, sans-serif" font-size="24" fill="#28a745" text-anchor="middle">✓</text>
  <text x="250" y="500" font-family="Arial, sans-serif" font-size="18" fill="#155724" font-weight="bold">타임아웃 방지</text>
  <text x="250" y="530" font-family="Arial, sans-serif" font-size="14" fill="#6c757d">AI 처리를 MQ로 분리 → HTTP 타임아웃 회피, 비동기 응답</text>

  <!-- TBD Section -->
  <rect x="970" y="160" width="850" height="400" rx="15" fill="white" filter="url(#shadow)"/>
  <text x="1395" y="205" font-family="Arial, sans-serif" font-size="22" fill="#2c3e50" text-anchor="middle" font-weight="bold">모니터링 &amp; 알림 (추후 구축)</text>

  <!-- TBD Item 1 -->
  <rect x="1010" y="240" width="770" height="80" rx="12" fill="#fff3cd"/>
  <rect x="1010" y="240" width="8" height="80" rx="4" fill="#ffc107"/>
  <rect x="1060" y="255" width="80" height="30" rx="15" fill="#8DABC4"/>
  <text x="1100" y="276" font-family="Arial, sans-serif" font-size="12" fill="white" text-anchor="middle">TBD</text>
  <text x="1160" y="275" font-family="Arial, sans-serif" font-size="18" fill="#856404" font-weight="bold">메트릭 수집</text>
  <text x="1060" y="305" font-family="Arial, sans-serif" font-size="14" fill="#6c757d">예정: Prometheus + Grafana 또는 CloudWatch</text>

  <!-- TBD Item 2 -->
  <rect x="1010" y="335" width="770" height="80" rx="12" fill="#fff3cd"/>
  <rect x="1010" y="335" width="8" height="80" rx="4" fill="#ffc107"/>
  <rect x="1060" y="350" width="80" height="30" rx="15" fill="#8DABC4"/>
  <text x="1100" y="371" font-family="Arial, sans-serif" font-size="12" fill="white" text-anchor="middle">TBD</text>
  <text x="1160" y="370" font-family="Arial, sans-serif" font-size="18" fill="#856404" font-weight="bold">알림 시스템</text>
  <text x="1060" y="400" font-family="Arial, sans-serif" font-size="14" fill="#6c757d">예정: Slack 알림, 이메일 알림 (처리 실패 시)</text>

  <!-- TBD Item 3 -->
  <rect x="1010" y="430" width="770" height="80" rx="12" fill="#fff3cd"/>
  <rect x="1010" y="430" width="8" height="80" rx="4" fill="#ffc107"/>
  <rect x="1060" y="445" width="80" height="30" rx="15" fill="#8DABC4"/>
  <text x="1100" y="466" font-family="Arial, sans-serif" font-size="12" fill="white" text-anchor="middle">TBD</text>
  <text x="1160" y="465" font-family="Arial, sans-serif" font-size="18" fill="#856404" font-weight="bold">자동 재처리</text>
  <text x="1060" y="495" font-family="Arial, sans-serif" font-size="14" fill="#6c757d">예정: Dead Letter Queue + Retry 정책 구현</text>

  <!-- State Tracking -->
  <rect x="100" y="590" width="1720" height="200" rx="15" fill="white" filter="url(#shadow)"/>
  <text x="960" y="635" font-family="Arial, sans-serif" font-size="22" fill="#2c3e50" text-anchor="middle" font-weight="bold">상태 추적 시스템</text>

  <!-- Current implementation -->
  <rect x="150" y="670" width="500" height="100" rx="10" fill="#d4edda"/>
  <text x="400" y="705" font-family="Arial, sans-serif" font-size="16" fill="#155724" text-anchor="middle" font-weight="bold">현재 구현됨</text>
  <text x="180" y="735" font-family="monospace" font-size="13" fill="#155724">• processingStatus (ENUM)</text>
  <text x="180" y="755" font-family="monospace" font-size="13" fill="#155724">• progressPercentage (0~100%)</text>

  <!-- DB Schema -->
  <rect x="700" y="670" width="500" height="100" rx="10" fill="#E8EEF4"/>
  <text x="950" y="705" font-family="Arial, sans-serif" font-size="16" fill="#4a5568" text-anchor="middle" font-weight="bold">DB 저장</text>
  <text x="730" y="735" font-family="monospace" font-size="13" fill="#4a5568">• Cloth 테이블에 상태/진행도 컬럼</text>
  <text x="730" y="755" font-family="monospace" font-size="13" fill="#4a5568">• 재접속 시 GET /cloth/{id}/status 조회</text>

  <!-- API Endpoint -->
  <rect x="1250" y="670" width="520" height="100" rx="10" fill="#F5E0D8"/>
  <text x="1510" y="705" font-family="Arial, sans-serif" font-size="16" fill="#5a4a42" text-anchor="middle" font-weight="bold">API 제공</text>
  <text x="1280" y="735" font-family="monospace" font-size="13" fill="#5a4a42">GET /api/v1/cloth/{id}/status</text>
  <text x="1280" y="755" font-family="monospace" font-size="13" fill="#6c757d">→ 현재 처리 상태 + 진행률 반환</text>

  <!-- Error Handling Flow -->
  <rect x="100" y="820" width="1720" height="160" rx="15" fill="white" filter="url(#shadow)"/>
  <text x="160" y="865" font-family="Arial, sans-serif" font-size="18" fill="#2c3e50" font-weight="bold">장애 시나리오 대응</text>

  <!-- Scenario 1 -->
  <rect x="150" y="890" width="380" height="70" rx="8" fill="#ffeaea"/>
  <text x="170" y="920" font-family="Arial, sans-serif" font-size="14" fill="#dc3545" font-weight="bold">시나리오: AI Worker 다운</text>
  <text x="170" y="945" font-family="Arial, sans-serif" font-size="12" fill="#6c757d">→ 메시지는 큐에 보존, Worker 재시작 후 처리 재개</text>

  <!-- Scenario 2 -->
  <rect x="560" y="890" width="380" height="70" rx="8" fill="#ffeaea"/>
  <text x="580" y="920" font-family="Arial, sans-serif" font-size="14" fill="#dc3545" font-weight="bold">시나리오: AI 처리 실패</text>
  <text x="580" y="945" font-family="Arial, sans-serif" font-size="12" fill="#6c757d">→ FAILED 마킹, 관리자가 원인 파악 후 재처리</text>

  <!-- Scenario 3 -->
  <rect x="970" y="890" width="380" height="70" rx="8" fill="#ffeaea"/>
  <text x="990" y="920" font-family="Arial, sans-serif" font-size="14" fill="#dc3545" font-weight="bold">시나리오: WebSocket 끊김</text>
  <text x="990" y="945" font-family="Arial, sans-serif" font-size="12" fill="#6c757d">→ SockJS Fallback + API 조회로 상태 복구</text>

  <!-- Scenario 4 -->
  <rect x="1380" y="890" width="380" height="70" rx="8" fill="#ffeaea"/>
  <text x="1400" y="920" font-family="Arial, sans-serif" font-size="14" fill="#dc3545" font-weight="bold">시나리오: RabbitMQ 재시작</text>
  <text x="1400" y="945" font-family="Arial, sans-serif" font-size="12" fill="#6c757d">→ Durable 큐로 메시지 유지, 자동 재연결</text>

  <!-- Speaker notes (simplified) -->
  <text x="100" y="1020" font-family="Arial, sans-serif" font-size="14" fill="#8DABC4" font-weight="bold">💬 발표 대본</text>
  <text x="100" y="1050" font-family="Arial, sans-serif" font-size="12" fill="#495057">운영 관점에서 안정성을 고려한 설계입니다. RabbitMQ 큐는 Durable 옵션으로 설정해서 브로커가 재시작되어도 메시지가 유실되지 않습니다. 모니터링과 알림 시스템은 추후 구축 예정입니다.</text>
</svg>
