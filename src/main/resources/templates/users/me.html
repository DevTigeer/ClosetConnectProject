<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="ko">
<head>
    <meta charset="UTF-8">
    <title>내 정보 | ClosetConnect</title>
    <link rel="stylesheet" th:href="@{/css/closet.css}">
    <style>
        .me-wrap { max-width: 600px; margin: 60px auto; background: #fff; padding: 26px; border-radius: 12px; box-shadow: 0 6px 20px rgba(0,0,0,0.05); }
        .me-title { font-size: 19px; margin-bottom: 16px; }
        .me-field { margin-bottom: 10px; }
        .me-label { font-weight: 600; margin-right: 6px; }
        .warn { background: #ffe2e2; padding: 10px; border-radius: 6px; margin-top: 12px; }
        .btn { margin-top: 14px; padding: 7px 16px; background: #5f5b5b; color: #fff; border: none; border-radius: 6px; cursor: pointer; }
    </style>
</head>
<body>
<div class="me-wrap">
    <h1 class="me-title">내 정보</h1>
    <p>이 페이지는 JWT가 제대로 들어가야만 정보를 볼 수 있어.</p>
    <div id="meResult" class="me-body">
        <div class="warn">아직 정보가 없습니다. 아래 버튼으로 /users/me API를 호출해보세요.</div>
    </div>
    <button id="loadMe" class="btn">/users/me 호출</button>
</div>

<script>
    document.querySelector('#loadMe').addEventListener('click', async () => {
        const token = localStorage.getItem('accessToken');
        if (!token) {
            alert('토큰이 없습니다. 먼저 로그인 해주세요.');
            return;
        }

        const res = await fetch('/users/me', {
            headers: {
                'Authorization': 'Bearer ' + token
            }
        });

        const el = document.querySelector('#meResult');

        if (res.ok) {
            const data = await res.json();
            el.innerHTML = `
                <div class="me-field"><span class="me-label">ID</span> ${data.id}</div>
                <div class="me-field"><span class="me-label">Email</span> ${data.email}</div>
                <div class="me-field"><span class="me-label">Nickname</span> ${data.nickname}</div>
                <div class="me-field"><span class="me-label">Role</span> ${data.role}</div>
            `;
        } else {
            el.innerHTML = `<div class="warn">요청 실패: ${res.status} (토큰이 없거나 만료되었을 수 있습니다.)</div>`;
        }
    });
</script>
</body>
</html>
