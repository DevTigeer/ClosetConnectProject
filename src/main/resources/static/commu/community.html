<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8" />
    <title>Community Boards</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <style>
        :root { --gap:14px; }
        body{margin:0;background:#fafafa;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,sans-serif}
        header{position:sticky;top:0;background:#fff;border-bottom:1px solid #eee;padding:12px 16px;display:flex;align-items:center;justify-content:space-between}
        .grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(220px,1fr));gap:var(--gap);padding:16px}
        .card{background:#fff;border:1px solid #eee;border-radius:12px;padding:14px}
        a{color:#222;text-decoration:none}
        .slug{font-size:12px;color:#888}
    </style>
</head>
<body>
<header>
    <strong>커뮤니티</strong>
    <nav><a href="/commu/admin-boards.html">관리자</a></nav>
</header>

<main class="grid" id="boardList"></main>

<script>
    (function(){
        'use strict';
        const token = localStorage.getItem('accessToken');

        const api = axios.create({
            baseURL: '',
            withCredentials: false,
            headers: token ? { Authorization: token.startsWith('Bearer ') ? token : `Bearer ${token}` } : {}
        });

        async function listPublicBoards(){
            const { data } = await api.get('/api/v1/community/boards');
            return data;
        }

        (async ()=>{
            try {
                const list = await listPublicBoards();
                const wrap = document.querySelector('#boardList');
                if (!list || list.length === 0) {
                    wrap.innerHTML = `<div class="card">표시할 보드가 없습니다.</div>`;
                    return;
                }
                wrap.innerHTML = list.map(b => `
        <a class="card" href="/commu/board.html?slug=${encodeURIComponent(b.slug)}">
          <div style="font-weight:600">${b.name}</div>
          <div class="slug">${b.slug} · ${b.type} · ${b.visibility}</div>
        </a>
      `).join('');
            } catch(e){
                console.error(e);
                alert('보드 목록 조회 실패');
            }
        })();
    })();
</script>
</body>
</html>
