<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>ê²Œì‹œê¸€ ë³´ê¸°</title>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <style>
        body { font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,sans-serif; margin:0; padding:0; background:#fafafa; }
        .container { max-width:700px; margin:40px auto; padding:20px; background:#fff; border-radius:12px; box-shadow:0 0 10px rgba(0,0,0,.05); }
        h1 { font-size:24px; margin-bottom:8px; }
        .meta { color:#777; font-size:14px; margin-bottom:20px; }
        .content { font-size:16px; line-height:1.6; margin-bottom:20px; }
        .btn-row { display:flex; gap:10px; }
        .btn { padding:8px 12px; border:1px solid #ddd; border-radius:6px; background:#fff; cursor:pointer; transition:.2s; }
        .btn:hover { background:#f2f2f2; }
        .like-count { margin-top:10px; color:#555; }
    </style>
</head>
<body>
<div class="container">
    <h1 id="post-title">ê²Œì‹œê¸€ ì œëª©</h1>
    <div class="meta" id="post-meta"></div>
    <div class="content" id="post-content"></div>

    <div class="btn-row">
        <button id="like-btn" class="btn">â¤ï¸ ì¢‹ì•„ìš”</button>
        <button id="delete-like-btn" class="btn">ğŸ’” ì¢‹ì•„ìš” ì·¨ì†Œ</button>
    </div>
    <div class="like-count" id="like-count"></div>
</div>

<script>
    (function () {
        'use strict';
        const token = localStorage.getItem('accessToken');
        const postId = new URLSearchParams(location.search).get('id');

        if (!postId) { alert('ê²Œì‹œê¸€ IDê°€ ì—†ìŠµë‹ˆë‹¤.'); history.back(); return; }
        if (!token)  { alert('ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.'); location.href = '/auth/login.html'; return; }

        axios.defaults.withCredentials = false;
        axios.defaults.headers.common['Authorization'] = token.startsWith('Bearer ') ? token : `Bearer ${token}`;

        async function loadPost() {
            try {
                const res = await axios.get(`/api/v1/posts/${postId}`);
                const post = res.data;
                document.getElementById('post-title').textContent = post.title;
                document.getElementById('post-meta').textContent = `ì‘ì„±ì: ${post.authorName} | ì‘ì„±ì¼: ${new Date(post.createdAt).toLocaleString()}`;
                document.getElementById('post-content').textContent = post.content ?? '';
                await updateLikeCount();
            } catch (err) {
                console.error(err);
                alert('ê²Œì‹œê¸€ì„ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.');
            }
        }

        async function updateLikeCount() {
            try {
                const res = await axios.get(`/api/v1/posts/${postId}/likes/count`);
                document.getElementById('like-count').textContent = `ì¢‹ì•„ìš” ${res.data.count}ê°œ`;
            } catch (err) {
                console.error(err);
            }
        }

        document.getElementById('like-btn').addEventListener('click', async () => {
            try {
                await axios.post(`/api/v1/posts/${postId}/like`);
                await updateLikeCount();
                alert('ì¢‹ì•„ìš” ì™„ë£Œ!');
            } catch (err) {
                console.error(err);
                alert('ì¢‹ì•„ìš”ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
            }
        });

        document.getElementById('delete-like-btn').addEventListener('click', async () => {
            try {
                await axios.delete(`/api/v1/posts/${postId}/like`);
                await updateLikeCount();
                alert('ì¢‹ì•„ìš” ì·¨ì†Œ ì™„ë£Œ!');
            } catch (err) {
                console.error(err?.response || err);
                if (err?.response?.status === 401) alert('ë¡œê·¸ì¸ í† í°ì´ ìœ íš¨í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.');
                else alert('ì¢‹ì•„ìš” ì·¨ì†Œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
            }
        });

        loadPost();
    })();
</script>
</body>
</html>
