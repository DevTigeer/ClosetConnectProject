<!-- src/main/resources/static/commu/board.html -->
<!DOCTYPE html><html lang="ko"><head>
    <meta charset="UTF-8"/><title>Board</title>
    <meta name="viewport" content="width=device-width, initial-scale=1"/>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <style>
        body{margin:0;background:#fafafa;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,sans-serif}
        header{position:sticky;top:0;background:#fff;border-bottom:1px solid #eee;padding:12px 16px;display:flex;align-items:center;gap:8px}
        .btn{padding:8px 10px;border:1px solid #ddd;background:#fff;border-radius:8px;cursor:pointer}
        .wrap{padding:16px;max-width:900px;margin:0 auto}
        .post{background:#fff;border:1px solid #eee;border-radius:12px;padding:12px;margin-bottom:10px}
        .row{display:flex;gap:8px;align-items:center}
    </style>
</head><body>
<header>
    <a class="btn" href="/commu/community.html">â† ëª©ë¡</a>
    <strong id="boardName">Board</strong>
    <span id="boardMeta" style="color:#888"></span>
    <button id="writeBtn" class="btn" style="margin-left:auto;display:none">ê¸€ì“°ê¸°</button>
</header>

<main class="wrap">
    <section id="posts"></section>
    <div class="row" style="justify-content:center;margin:12px 0">
        <button id="prev" class="btn">ì´ì „</button>
        <span id="pageInfo"></span>
        <button id="next" class="btn">ë‹¤ìŒ</button>
    </div>
</main>

<script>
    (function(){
        const q=(s,p=document)=>p.querySelector(s);
        const qp=(k)=>new URLSearchParams(location.search).get(k);
        const api=axios.create({baseURL:'',withCredentials:true});
        api.interceptors.request.use(cfg=>{const t=localStorage.getItem('accessToken'); if(t) cfg.headers.Authorization=`Bearer ${t}`; return cfg;});

        const getBoardBySlug=(slug)=>api.get(`/api/v1/community/boards/${slug}`).then(r=>r.data);
        const listPosts=({boardId,page=0,size=10,sort='LATEST'})=>api.get(`/api/v1/boards/${boardId}/posts`,{params:{page,size,sort}}).then(r=>r.data);

        (async()=>{
            const slug=qp('slug');
            if(!slug){ alert('slug ëˆ„ë½'); location.href='/commu/community.html'; return; }

            const board=await getBoardBySlug(slug);
            q('#boardName').textContent=board.name;
            q('#boardMeta').textContent=`${board.slug} Â· ${board.type} Â· ${board.visibility}`;
            const boardId=board.id;

            // í† í° ìˆìœ¼ë©´ ê¸€ì“°ê¸° ë²„íŠ¼ ë…¸ì¶œ
            if(localStorage.getItem('accessToken')){
                q('#writeBtn').style.display='inline-block';
                q('#writeBtn').onclick=()=>location.href=`/commu/post-new.html?slug=${encodeURIComponent(slug)}`;
            }

            let page=0, size=10, sort='LATEST';
            async function load(){
                const data=await listPosts({boardId,page,size,sort});
                q('#posts').innerHTML=data.content.map(p=>`
        <article class="post">
          <a href="/commu/post.html?id=${p.id}" style="font-weight:600">${p.title}</a>
          <div style="color:#888;font-size:12px">by ${p.authorName} Â· ${new Date(p.createdAt).toLocaleString()} Â· â¤ï¸ ${p.likeCount} Â· ğŸ‘ï¸ ${p.viewCount}</div>
          <div style="margin-top:6px;white-space:pre-wrap;color:#333">${(p.content||'').slice(0,120)}</div>
        </article>`).join('');
                q('#pageInfo').textContent=`${data.number+1} / ${data.totalPages||1}`;
                q('#prev').disabled=data.first; q('#next').disabled=data.last;
            }
            q('#prev').onclick=()=>{ if(page>0){page--; load();} };
            q('#next').onclick=()=>{ page++; load(); };
            await load();
        })().catch(e=>{console.error(e); alert('ë³´ë“œ/ê²Œì‹œê¸€ ìš”ì²­ ì‹¤íŒ¨');});
    })();
</script>
</body></html>
