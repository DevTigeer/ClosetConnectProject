# 요구사항 정의서 (PRD - Product Requirements Document)

**작성일**: 2024-12-30
**작성자**: Development Team
**버전**: 1.0

---

## 📌 요약

ClosetConnect의 기능 요구사항을 정의하고, MVP와 Phase 2를 구분하여 개발 우선순위를 명확히 합니다.

---

## 1. 기능 목록

### 1.1 인증/회원 관리 (MVP)

#### F-AUTH-001: 회원가입
- **설명**: 이메일, 비밀번호, 닉네임으로 회원가입
- **입력**: 이메일, 비밀번호, 닉네임
- **출력**: JWT 토큰
- **검증**:
  - 이메일 중복 체크
  - 닉네임 중복 체크
  - 비밀번호 암호화(BCrypt)

#### F-AUTH-002: 로그인
- **설명**: 이메일/비밀번호로 로그인
- **입력**: 이메일, 비밀번호
- **출력**: JWT 토큰
- **검증**:
  - 비밀번호 일치 확인
  - 토큰 유효기간: 1시간

#### F-AUTH-003: 자동 로그아웃
- **설명**: JWT 토큰 만료 시 자동 로그아웃
- **동작**: 401 응답 시 로컬스토리지 토큰 삭제 및 UI 업데이트

---

### 1.2 옷장 관리 (MVP)

#### F-CLOSET-001: 옷 등록
- **설명**: 사진 업로드로 옷 등록
- **입력**: 이미지 파일, 옷 이름, 카테고리
- **처리**:
  1. 이미지 업로드
  2. AI 배경 제거 (rembg)
  3. 세그멘테이션 (U2Net)
  4. 인페인팅 (LaMa)
- **출력**: 처리된 이미지 URL 목록
- **비동기**: RabbitMQ 메시지 큐 사용

#### F-CLOSET-002: 이미지 선택 확정
- **설명**: AI 처리 결과 중 최종 이미지 선택
- **입력**: 선택한 이미지 URL, 카테고리
- **출력**: 옷 정보 저장 완료

#### F-CLOSET-003: 옷 목록 조회
- **설명**: 내 옷장의 옷 목록 조회
- **필터**: 카테고리별 필터링 (TOP, BOTTOM, SHOES, ACC)
- **페이징**: 지원
- **정렬**: 최신 순

#### F-CLOSET-004: 옷 삭제
- **설명**: 옷장에서 옷 삭제
- **권한**: 본인만 삭제 가능

---

### 1.3 AI 코디 (Phase 2) ✅ 완료

#### F-OUTFIT-001: AI 코디 생성
- **설명**: 여러 옷을 조합하여 가상 착용 이미지 생성
- **입력**: 상의, 하의, 신발, 액세서리 선택
- **AI**: Google Gemini Imagen 3
- **출력**: 합성된 코디 이미지
- **제약**: 최소 1개 이상 선택 필수

#### F-OUTFIT-002: OOTD 저장
- **설명**: 생성된 코디 이미지를 OOTD로 저장
- **입력**: 코디 이미지 URL, 설명(선택)
- **출력**: OOTD ID

#### F-OUTFIT-003: OOTD 목록 조회
- **설명**: 저장된 OOTD 갤러리 형식으로 조회
- **정렬**: 최신 순
- **기능**: 확대 보기, 다운로드, 삭제

---

### 1.4 날씨 추천 (MVP)

#### F-WEATHER-001: 현재 위치 날씨 조회
- **설명**: GPS 기반 현재 위치 날씨 정보
- **API**: OpenWeather API
- **출력**: 온도, 날씨 상태, 습도

#### F-WEATHER-002: 도시별 날씨 조회
- **설명**: 사전 정의된 도시의 날씨 조회
- **도시**: 서울, 부산, 제주 등

#### F-WEATHER-003: 날씨 기반 옷 추천
- **설명**: 현재 날씨에 맞는 옷 추천
- **로직**:
  - 25도 이상: 반팔, 반바지
  - 20-25도: 긴팔, 긴바지
  - 15-20도: 가디건, 자켓
  - 15도 이하: 코트, 패딩

---

### 1.5 커뮤니티 (MVP)

#### F-COMMUNITY-001: 게시판 목록 조회
- **설명**: 공개 게시판 목록
- **출력**: 게시판 이름, slug, 게시글 수

#### F-COMMUNITY-002: 게시글 작성
- **설명**: 특정 게시판에 게시글 작성
- **입력**: 제목, 내용, 첨부파일(선택)
- **권한**: 로그인 필수

#### F-COMMUNITY-003: 게시글 조회
- **설명**: 게시글 상세 보기
- **출력**: 제목, 내용, 작성자, 작성일, 조회수, 좋아요 수

#### F-COMMUNITY-004: 댓글 작성
- **설명**: 게시글에 댓글 작성
- **입력**: 댓글 내용
- **권한**: 로그인 필수

#### F-COMMUNITY-005: 좋아요
- **설명**: 게시글에 좋아요 추가/취소
- **권한**: 로그인 필수

---

### 1.6 중고거래 (MVP)

#### F-MARKET-001: 상품 등록
- **설명**: 중고 의류 판매 상품 등록
- **입력**: 제목, 설명, 가격, 이미지, 카테고리, 사이즈, 상태
- **출력**: 상품 ID

#### F-MARKET-002: 상품 목록 조회
- **필터**: 카테고리, 가격 범위, 상태
- **검색**: 제목, 설명
- **정렬**: 최신 순, 가격 순

#### F-MARKET-003: 상품 찜
- **설명**: 관심 상품 찜하기
- **출력**: 찜 목록에서 조회 가능

#### F-MARKET-004: 채팅
- **설명**: 구매자-판매자 간 1:1 채팅
- **프로토콜**: WebSocket (STOMP)
- **기능**: 메시지 전송, 읽음 표시

#### F-MARKET-005: 주문/결제
- **설명**: TossPayments 연동 결제
- **프로세스**:
  1. 주문 생성
  2. 결제 요청
  3. 결제 승인
  4. 주문 상태 변경

#### F-MARKET-006: 발송 처리
- **설명**: 판매자가 발송 완료 처리
- **입력**: 송장번호
- **상태 변경**: PAID → SHIPPED

#### F-MARKET-007: 구매 확정
- **설명**: 구매자가 상품 수령 확인
- **상태 변경**: SHIPPED → DELIVERED

---

## 2. 유저 시나리오

### 시나리오 1: 옷 등록 및 코디 생성

1. 사용자가 로그인
2. "내 옷장" 메뉴 클릭
3. "옷 추가" 버튼 클릭
4. 옷 사진 업로드 (예: 흰색 티셔츠)
5. 옷 이름 입력: "흰색 라운드넥 티셔츠"
6. 카테고리 선택: "상의"
7. 업로드 → AI 처리 시작 (진행도 표시)
8. 처리 완료 후 결과 이미지 선택 (원본, 배경제거, 세그먼트 등)
9. 최종 이미지 확정
10. "조합하기" 버튼 클릭
11. 상의, 하의, 신발 선택
12. "조합 생성하기" 클릭
13. AI 코디 이미지 생성
14. "OOTD 저장" 클릭
15. OOTD 메뉴에서 저장된 코디 확인

### 시나리오 2: 중고거래

1. 사용자가 "중고거래" 메뉴 클릭
2. 상품 목록 조회
3. 관심 상품 클릭
4. 상품 상세 정보 확인
5. "채팅하기" 클릭
6. 판매자와 채팅
7. "구매하기" 클릭
8. 결제 정보 입력
9. TossPayments 결제 완료
10. 주문 내역에서 상태 확인
11. 상품 수령 후 "구매 확정"

---

## 3. 예외 케이스

### 옷 등록 예외
- **케이스**: 지원하지 않는 이미지 형식
  - **대응**: 에러 메시지 표시 "JPG, PNG 형식만 지원합니다"

- **케이스**: 이미지 파일 크기 초과 (5MB)
  - **대응**: 에러 메시지 표시 "파일 크기는 5MB 이하여야 합니다"

- **케이스**: AI 처리 실패
  - **대응**: 재시도 버튼 제공, 실패 로그 저장

### AI 코디 예외
- **케이스**: 아무것도 선택하지 않음
  - **대응**: 버튼 비활성화 + 안내 메시지

- **케이스**: Gemini API 호출 실패
  - **대응**: 에러 메시지 "AI 코디 생성에 실패했습니다. 다시 시도해주세요."

### 결제 예외
- **케이스**: 결제 중 이탈
  - **대응**: 주문 상태 "PENDING" 유지, 30분 후 자동 취소

- **케이스**: 카드 승인 실패
  - **대응**: 에러 메시지 + 주문 취소

---

## 4. 비기능 요구사항

### 4.1 성능
- **응답 시간**: API 호출 2초 이내 (AI 처리 제외)
- **AI 처리**: 1분 이내 완료 목표
- **동시 접속**: 100명 이상 지원

### 4.2 보안
- **인증**: JWT 기반 인증
- **비밀번호**: BCrypt 암호화
- **파일 업로드**: 확장자 검증
- **XSS 방지**: 입력 값 sanitization

### 4.3 확장성
- **DB 커넥션 풀**: HikariCP
- **메시지 큐**: RabbitMQ (수평 확장 가능)
- **이미지 스토리지**: 로컬 → S3 전환 가능

### 4.4 비용
- **Gemini API**: 월 $50 이내
- **TossPayments**: 거래 수수료 3.3%
- **서버**: 단일 서버 (향후 클라우드 전환)

---

## 변경 이력

| 날짜 | 버전 | 작성자 | 변경 내용 |
|------|------|--------|-----------|
| 2024-12-30 | 1.0 | Development Team | 초기 문서 작성 |
