# API ì„¤ê³„ ë¬¸ì„œ

**ì‘ì„±ì¼**: 2024-12-30
**ì‘ì„±ì**: Development Team
**ë²„ì „**: 1.0

---

## ğŸ“Œ ìš”ì•½

ClosetConnectì˜ REST API ì„¤ê³„ë¥¼ ì •ì˜í•˜ê³ , ì¸ì¦ ë°©ì‹, ì—ëŸ¬ ì½”ë“œ, ë²„ì €ë‹ ì „ëµì„ ëª…í™•íˆ í•©ë‹ˆë‹¤.

---

## 1. API ëª©ì 

- **RESTful API**: ìì› ì¤‘ì‹¬ ì„¤ê³„
- **Stateless**: JWT ê¸°ë°˜ ë¬´ìƒíƒœ ì¸ì¦
- **JSON**: ìš”ì²­/ì‘ë‹µ ëª¨ë‘ JSON í˜•ì‹

---

## 2. Base URL

- **ê°œë°œ**: `http://localhost:8080`
- **ìš´ì˜**: `https://api.closetconnect.com`

---

## 3. ì¸ì¦ ë°©ì‹

### 3.1 JWT Bearer Token

ëª¨ë“  ì¸ì¦ í•„ìš” APIëŠ” Authorization í—¤ë”ì— JWT í† í° í¬í•¨:

```
Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
```

### 3.2 ë¡œê·¸ì¸ Flow

```
1. POST /api/v1/auth/login
   Request: { "email": "user@test.com", "password": "pw123" }
   Response: { "accessToken": "eyJ...", "email": "user@test.com" }

2. ì´í›„ ëª¨ë“  ìš”ì²­ì— í—¤ë” í¬í•¨:
   Authorization: Bearer eyJ...
```

---

## 4. ì£¼ìš” API ì—”ë“œí¬ì¸íŠ¸

### 4.1 ì¸ì¦ (Auth)

#### POST /api/v1/auth/signup
**ì„¤ëª…**: íšŒì›ê°€ì…

**Request**:
```json
{
  "email": "user@test.com",
  "password": "password123",
  "nickname": "ë‹‰ë„¤ì„"
}
```

**Response (200)**:
```json
{
  "accessToken": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
  "email": "user@test.com",
  "nickname": "ë‹‰ë„¤ì„",
  "role": "ROLE_USER"
}
```

#### POST /api/v1/auth/login
**ì„¤ëª…**: ë¡œê·¸ì¸

**Request**:
```json
{
  "email": "user@test.com",
  "password": "password123"
}
```

**Response (200)**:
```json
{
  "accessToken": "eyJ...",
  "email": "user@test.com",
  "nickname": "ë‹‰ë„¤ì„"
}
```

---

### 4.2 ì˜·ì¥ (Cloth)

#### POST /api/v1/cloth/upload
**ì„¤ëª…**: ì˜· ì´ë¯¸ì§€ ì—…ë¡œë“œ ë° AI ì²˜ë¦¬ ì‹œì‘

**ì¸ì¦**: í•„ìˆ˜

**Request** (multipart/form-data):
- `image`: ì´ë¯¸ì§€ íŒŒì¼ (JPG, PNG, 5MB ì´í•˜)
- `name`: ì˜· ì´ë¦„
- `category`: TOP, BOTTOM, SHOES, ACC
- `imageType`: FULL_BODY (ê¸°ë³¸ê°’)

**Response (200)**:
```json
{
  "id": 123,
  "name": "í°ìƒ‰ í‹°ì…”ì¸ ",
  "category": "TOP",
  "status": "PROCESSING",
  "imageUrl": "/uploads/cloth/123_original.png"
}
```

#### POST /api/v1/cloth/{id}/confirm-image
**ì„¤ëª…**: AI ì²˜ë¦¬ ì™„ë£Œ í›„ ìµœì¢… ì´ë¯¸ì§€ ì„ íƒ

**Request**:
```json
{
  "selectedImageType": "INPAINTED",
  "category": "TOP"
}
```

**Response (200)**:
```json
{
  "id": 123,
  "status": "CONFIRMED",
  "imageUrl": "/uploads/cloth/123_inpainted.png"
}
```

#### GET /api/v1/cloth
**ì„¤ëª…**: ë‚´ ì˜·ì¥ ëª©ë¡ ì¡°íšŒ

**Query Parameters**:
- `category` (optional): TOP, BOTTOM, SHOES, ACC
- `page` (optional): í˜ì´ì§€ ë²ˆí˜¸ (ê¸°ë³¸ 0)
- `size` (optional): í˜ì´ì§€ í¬ê¸° (ê¸°ë³¸ 20)

**Response (200)**:
```json
{
  "content": [
    {
      "id": 123,
      "name": "í°ìƒ‰ í‹°ì…”ì¸ ",
      "category": "TOP",
      "imageUrl": "/uploads/cloth/123.png",
      "createdAt": "2024-12-30T10:00:00"
    }
  ],
  "totalElements": 100,
  "totalPages": 5,
  "number": 0,
  "size": 20
}
```

---

### 4.3 AI ì½”ë”” (Outfit)

#### POST /api/v1/outfit/tryon
**ì„¤ëª…**: AI ì½”ë”” ìƒì„±

**ì¸ì¦**: í•„ìˆ˜

**Request**:
```json
{
  "upperClothesId": 123,
  "lowerClothesId": 456,
  "shoesId": 789,
  "accessoriesIds": [111, 222]
}
```

**Response (200)**:
```json
{
  "success": true,
  "imageUrl": "/uploads/outfit/result-xxx.png",
  "engine": "Gemini Imagen 3"
}
```

---

### 4.4 OOTD

#### POST /api/v1/ootd
**ì„¤ëª…**: OOTD ì €ì¥

**ì¸ì¦**: í•„ìˆ˜

**Request**:
```json
{
  "imageUrl": "/uploads/outfit/result-xxx.png",
  "description": "ìºì£¼ì–¼ ì½”ë””"
}
```

**Response (200)**:
```json
{
  "id": 1,
  "imageUrl": "/uploads/outfit/result-xxx.png",
  "description": "ìºì£¼ì–¼ ì½”ë””",
  "createdAt": "2024-12-30T15:30:00"
}
```

#### GET /api/v1/ootd
**ì„¤ëª…**: ë‚´ OOTD ëª©ë¡ ì¡°íšŒ

**Response (200)**:
```json
[
  {
    "id": 1,
    "imageUrl": "/uploads/outfit/result-xxx.png",
    "description": "ìºì£¼ì–¼ ì½”ë””",
    "createdAt": "2024-12-30T15:30:00"
  }
]
```

#### DELETE /api/v1/ootd/{id}
**ì„¤ëª…**: OOTD ì‚­ì œ

**Response (204)**: No Content

---

### 4.5 ì»¤ë®¤ë‹ˆí‹° (Community)

#### GET /api/v1/community/boards
**ì„¤ëª…**: ê³µê°œ ê²Œì‹œíŒ ëª©ë¡

**Response (200)**:
```json
[
  {
    "id": 1,
    "name": "ììœ ê²Œì‹œíŒ",
    "slug": "free",
    "postCount": 150
  }
]
```

#### GET /api/v1/boards/{boardId}/posts
**ì„¤ëª…**: ê²Œì‹œê¸€ ëª©ë¡

**Query Parameters**:
- `page`, `size`

**Response (200)**:
```json
{
  "content": [
    {
      "id": 101,
      "title": "ì œëª©",
      "author": "ì‘ì„±ì",
      "createdAt": "2024-12-30T10:00:00",
      "viewCount": 50
    }
  ],
  "totalElements": 100
}
```

---

### 4.6 ì¤‘ê³ ê±°ë˜ (Market)

#### GET /api/v1/market/products
**ì„¤ëª…**: ìƒí’ˆ ëª©ë¡

**Query Parameters**:
- `category` (optional)
- `minPrice`, `maxPrice` (optional)
- `status` (optional): SALE, RESERVED, SOLD_OUT
- `search` (optional): ê²€ìƒ‰ì–´

**Response (200)**:
```json
{
  "content": [
    {
      "id": 1,
      "title": "ê¹¨ë—í•œ í°ìƒ‰ í‹°ì…”ì¸ ",
      "price": 15000,
      "status": "SALE",
      "imageUrls": ["/uploads/market/1.png"],
      "seller": "íŒë§¤ìë‹‰ë„¤ì„"
    }
  ]
}
```

#### POST /api/v1/market/orders
**ì„¤ëª…**: ì£¼ë¬¸ ìƒì„±

**Request**:
```json
{
  "productId": 1,
  "buyerName": "êµ¬ë§¤ì",
  "buyerPhone": "010-1234-5678",
  "address": "ì„œìš¸ì‹œ ê°•ë‚¨êµ¬..."
}
```

**Response (200)**:
```json
{
  "orderId": 123,
  "amount": 15000,
  "paymentUrl": "https://tosspayments.com/payment/..."
}
```

---

## 5. ì—ëŸ¬ ì½”ë“œ ì •ì±…

### 5.1 HTTP Status Code

| Code | ì˜ë¯¸ | ì‚¬ìš© ì‹œì  |
|------|------|-----------|
| 200 | OK | ì •ìƒ ì‘ë‹µ |
| 201 | Created | ë¦¬ì†ŒìŠ¤ ìƒì„± ì„±ê³µ |
| 204 | No Content | ì‚­ì œ ì„±ê³µ (ì‘ë‹µ ë³¸ë¬¸ ì—†ìŒ) |
| 400 | Bad Request | ìš”ì²­ íŒŒë¼ë¯¸í„° ì˜¤ë¥˜ |
| 401 | Unauthorized | ì¸ì¦ ì‹¤íŒ¨ (í† í° ì—†ìŒ/ë§Œë£Œ) |
| 403 | Forbidden | ê¶Œí•œ ì—†ìŒ |
| 404 | Not Found | ë¦¬ì†ŒìŠ¤ ì—†ìŒ |
| 500 | Internal Server Error | ì„œë²„ ë‚´ë¶€ ì˜¤ë¥˜ |

### 5.2 ì—ëŸ¬ ì‘ë‹µ í˜•ì‹

```json
{
  "timestamp": "2024-12-30T10:00:00",
  "status": 400,
  "error": "Bad Request",
  "message": "íŒŒì¼ í¬ê¸°ëŠ” 5MB ì´í•˜ì—¬ì•¼ í•©ë‹ˆë‹¤.",
  "path": "/api/v1/cloth/upload"
}
```

### 5.3 ì»¤ìŠ¤í…€ ì—ëŸ¬ ì½”ë“œ (í–¥í›„)

```json
{
  "errorCode": "CLOTH_001",
  "message": "ì§€ì›í•˜ì§€ ì•ŠëŠ” ì´ë¯¸ì§€ í˜•ì‹ì…ë‹ˆë‹¤.",
  "field": "image",
  "rejectedValue": "file.pdf"
}
```

---

## 6. ë²„ì €ë‹ ì „ëµ

### í˜„ì¬ (v1)
- URLì— ë²„ì „ í¬í•¨: `/api/v1/...`
- í•˜ìœ„ í˜¸í™˜ì„± ìœ ì§€ ì›ì¹™

### í–¥í›„ (v2)
- Breaking Change ë°œìƒ ì‹œ `/api/v2/...` ë„ì…
- v1ê³¼ v2 ë³‘í–‰ ìš´ì˜ (ìµœì†Œ 6ê°œì›”)

---

## 7. Rate Limiting (í–¥í›„)

### ê³„íš
- ë¹„ì¸ì¦ ì‚¬ìš©ì: 100 req/min
- ì¸ì¦ ì‚¬ìš©ì: 1000 req/min
- AI ì½”ë”” ìƒì„±: 10 req/day/user

### ì‘ë‹µ í—¤ë”
```
X-RateLimit-Limit: 1000
X-RateLimit-Remaining: 999
X-RateLimit-Reset: 1640995200
```

### ì´ˆê³¼ ì‹œ
```json
{
  "status": 429,
  "message": "Rate limit exceeded. Try again in 60 seconds."
}
```

---

## 8. Swagger/OpenAPI

### ì ‘ì† URL
- **ê°œë°œ**: http://localhost:8080/swagger-ui/index.html
- **ìš´ì˜**: https://api.closetconnect.com/swagger-ui/index.html

### íŠ¹ì§•
- ìë™ ìƒì„± (SpringDoc)
- API í…ŒìŠ¤íŠ¸ ê°€ëŠ¥
- JWT í† í° ì…ë ¥ ì§€ì›

---

## ë³€ê²½ ì´ë ¥

| ë‚ ì§œ | ë²„ì „ | ì‘ì„±ì | ë³€ê²½ ë‚´ìš© |
|------|------|--------|-----------|
| 2024-12-30 | 1.0 | Development Team | ì´ˆê¸° ë¬¸ì„œ ì‘ì„± |
