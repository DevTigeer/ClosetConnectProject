# ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜ ë¬¸ì„œ

**ì‘ì„±ì¼**: 2024-12-30
**ì‘ì„±ì**: Development Team
**ë²„ì „**: 1.0

---

## ğŸ“Œ ìš”ì•½

ClosetConnectëŠ” **Spring Boot Backend + React Frontend + Python AI Server**ë¡œ êµ¬ì„±ëœ 3-Tier ì•„í‚¤í…ì²˜ì´ë©°, RabbitMQë¥¼ í†µí•œ ë¹„ë™ê¸° ë©”ì‹œì§€ íì™€ WebSocket ì‹¤ì‹œê°„ í†µì‹ ì„ í™œìš©í•©ë‹ˆë‹¤.

---

## 1. ì „ì²´ ì•„í‚¤í…ì²˜ ë‹¤ì´ì–´ê·¸ë¨

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   ì‚¬ìš©ì ë¸Œë¼ìš°ì €   â”‚
â”‚   (React SPA)   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚ HTTP/WS
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚       Nginx (Reverse Proxy)            â”‚
â”‚  - Static Files (/uploads)             â”‚
â”‚  - API Proxy (â†’ Spring Boot)           â”‚
â”‚  - WebSocket Proxy (â†’ Spring Boot)     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
    â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”
    â†“         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Spring  â”‚  â”‚   Python    â”‚
â”‚   Boot   â”‚  â”‚  AI Server  â”‚
â”‚  Backend â”‚  â”‚  (FastAPI)  â”‚
â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
      â”‚              â”‚
      â”‚  RabbitMQ    â”‚
      â”‚   Message    â”‚
      â”‚     Queue    â”‚
      â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”
    â†“                 â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ MariaDB â”‚      â”‚  ì™¸ë¶€ API  â”‚
â”‚   DB    â”‚      â”‚ - Gemini  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚ - Weather â”‚
                 â”‚ - Toss    â”‚
                 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 2. ì»´í¬ë„ŒíŠ¸ ì—­í• 

### 2.1 Frontend (React)
- **ì—­í• **: ì‚¬ìš©ì ì¸í„°í˜ì´ìŠ¤
- **ì£¼ìš” ê¸°ëŠ¥**:
  - ì˜·ì¥ ê´€ë¦¬ UI
  - AI ì½”ë”” ì¡°í•© UI
  - ì»¤ë®¤ë‹ˆí‹°, ì¤‘ê³ ê±°ë˜ UI
  - WebSocket ì§„í–‰ë„ í‘œì‹œ
- **ê¸°ìˆ **:
  - React 18 + Vite
  - React Router (SPA ë¼ìš°íŒ…)
  - Axios (HTTP í´ë¼ì´ì–¸íŠ¸)
  - STOMP.js (WebSocket)
- **í¬íŠ¸**: 5173 (ê°œë°œ), ë°°í¬ ì‹œ Nginx

### 2.2 Backend (Spring Boot)
- **ì—­í• **: ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§, API, ì¸ì¦
- **ì£¼ìš” ê¸°ëŠ¥**:
  - REST API ì œê³µ
  - JWT ì¸ì¦/ì¸ê°€
  - RabbitMQ Producer (AI ì‘ì—… ìš”ì²­)
  - WebSocket Server (ì§„í–‰ë„ ì „ì†¡)
  - DB CRUD
- **ê¸°ìˆ **:
  - Spring Boot 3.5.7
  - Spring Security + JWT
  - Spring Data JPA
  - RabbitMQ Client
  - STOMP WebSocket
- **í¬íŠ¸**: 8080

### 2.3 AI Server (Python)
- **ì—­í• **: AI ì´ë¯¸ì§€ ì²˜ë¦¬
- **ì£¼ìš” ê¸°ëŠ¥**:
  - ë°°ê²½ ì œê±° (rembg)
  - ì„¸ê·¸ë©˜í…Œì´ì…˜ (U2Net)
  - ì¸í˜ì¸íŒ… (LaMa)
  - ê°€ìƒ Try-On (Gemini Imagen 3)
- **ê¸°ìˆ **:
  - FastAPI
  - RabbitMQ Consumer
  - OpenCV, PIL
  - Google Generative AI SDK
- **í¬íŠ¸**: 8000, 8001

### 2.4 Message Queue (RabbitMQ)
- **ì—­í• **: ë¹„ë™ê¸° ì‘ì—… í
- **ì£¼ìš” í**:
  - `cloth.processing.queue`: ì˜· AI ì²˜ë¦¬ ìš”ì²­
  - `cloth.progress.queue`: ì§„í–‰ë„ ì—…ë°ì´íŠ¸
  - `cloth.result.queue`: ì²˜ë¦¬ ê²°ê³¼
- **í¬íŠ¸**: 5672 (AMQP), 15672 (Management UI)

### 2.5 Database (MariaDB)
- **ì—­í• **: ì˜êµ¬ ë°ì´í„° ì €ì¥
- **ì£¼ìš” í…Œì´ë¸”**:
  - users, cloth, ootd
  - community_board, post, comment
  - market_product, market_order
- **í¬íŠ¸**: 3306

---

## 3. ë°ì´í„° íë¦„

### 3.1 ì˜· ë“±ë¡ ë° AI ì²˜ë¦¬ íë¦„

```
1. ì‚¬ìš©ì â†’ React: ì´ë¯¸ì§€ ì—…ë¡œë“œ
   â†“
2. React â†’ Spring Boot: POST /api/v1/cloth/upload
   â†“
3. Spring Boot:
   - ì´ë¯¸ì§€ ì €ì¥ (/uploads)
   - Cloth ì—”í‹°í‹° ìƒì„± (status: PROCESSING)
   - RabbitMQì— ë©”ì‹œì§€ ë°œí–‰
   â†“
4. RabbitMQ â†’ Python AI Server:
   - ë©”ì‹œì§€ ìˆ˜ì‹ 
   - ë°°ê²½ ì œê±°, ì„¸ê·¸ë©˜í…Œì´ì…˜, ì¸í˜ì¸íŒ… ìˆœì°¨ ì‹¤í–‰
   - ê° ë‹¨ê³„ë§ˆë‹¤ ì§„í–‰ë„ ë©”ì‹œì§€ ë°œí–‰
   â†“
5. Python â†’ RabbitMQ â†’ Spring Boot â†’ WebSocket â†’ React:
   - ì§„í–‰ë„ ì—…ë°ì´íŠ¸ ì‹¤ì‹œê°„ ì „ì†¡
   â†“
6. Python â†’ RabbitMQ â†’ Spring Boot:
   - ì²˜ë¦¬ ì™„ë£Œ ë©”ì‹œì§€
   - Cloth ì—”í‹°í‹° ì—…ë°ì´íŠ¸ (status: READY_FOR_REVIEW)
   â†“
7. React: ì²˜ë¦¬ ì™„ë£Œ ì•Œë¦¼, ê²°ê³¼ ì´ë¯¸ì§€ ì„ íƒ UI í‘œì‹œ
```

### 3.2 AI ì½”ë”” ìƒì„± íë¦„

```
1. ì‚¬ìš©ì â†’ React: ì˜· ì„ íƒ (ìƒì˜, í•˜ì˜, ì‹ ë°œ ë“±)
   â†“
2. React â†’ Spring Boot: POST /api/v1/outfit/tryon
   â†“
3. Spring Boot â†’ Python AI Server: HTTP ìš”ì²­
   - ì„ íƒí•œ ì˜· ì´ë¯¸ì§€ URL ì „ë‹¬
   â†“
4. Python AI Server:
   - ë™ì  í”„ë¡¬í”„íŠ¸ ìƒì„±
   - Google Gemini API í˜¸ì¶œ
   - í•©ì„± ì´ë¯¸ì§€ ìƒì„±
   â†“
5. Python â†’ Spring Boot: í•©ì„± ì´ë¯¸ì§€ URL ì‘ë‹µ
   â†“
6. Spring Boot â†’ React: í•©ì„± ì´ë¯¸ì§€ URL ì‘ë‹µ
   â†“
7. ì‚¬ìš©ì: OOTD ì €ì¥ í´ë¦­ â†’ POST /api/v1/ootd
```

### 3.3 ì¤‘ê³ ê±°ë˜ ê²°ì œ íë¦„

```
1. ì‚¬ìš©ì â†’ React: êµ¬ë§¤í•˜ê¸°
   â†“
2. React â†’ Spring Boot: POST /api/v1/market/orders
   â†“
3. Spring Boot:
   - Order ìƒì„± (status: PENDING)
   - TossPayments ê²°ì œ URL ìƒì„±
   â†“
4. Spring Boot â†’ React: ê²°ì œ URL
   â†“
5. React â†’ TossPayments: ê²°ì œ í˜ì´ì§€ ë¦¬ë‹¤ì´ë ‰íŠ¸
   â†“
6. TossPayments â†’ React: ê²°ì œ ì™„ë£Œ ì½œë°±
   â†“
7. React â†’ Spring Boot: POST /api/v1/market/payments/confirm
   â†“
8. Spring Boot â†’ TossPayments API: ê²°ì œ ìŠ¹ì¸ ìš”ì²­
   â†“
9. TossPayments â†’ Spring Boot: ìŠ¹ì¸ ì™„ë£Œ
   â†“
10. Spring Boot:
    - Order ìƒíƒœ ë³€ê²½ (PENDING â†’ PAID)
    - Product ìƒíƒœ ë³€ê²½ (SALE â†’ RESERVED)
```

---

## 4. ì™¸ë¶€ ì—°ë™

### 4.1 Google Gemini AI
- **ìš©ë„**: ê°€ìƒ Try-On ì´ë¯¸ì§€ ìƒì„±
- **API**: Generative Language API (Imagen 3)
- **ì¸ì¦**: API Key
- **ì—”ë“œí¬ì¸íŠ¸**: `https://generativelanguage.googleapis.com`
- **ë¹„ìš©**: $0.04/image

### 4.2 OpenWeather API
- **ìš©ë„**: ë‚ ì”¨ ì •ë³´ ì¡°íšŒ
- **API**: Current Weather Data
- **ì¸ì¦**: API Key
- **ì—”ë“œí¬ì¸íŠ¸**: `https://api.openweathermap.org/data/2.5/weather`
- **ë¹„ìš©**: Free tier (60 calls/min)

### 4.3 TossPayments
- **ìš©ë„**: ê²°ì œ ì²˜ë¦¬
- **API**: TossPayments API v1
- **ì¸ì¦**: Secret Key
- **ì—”ë“œí¬ì¸íŠ¸**: `https://api.tosspayments.com`
- **ìˆ˜ìˆ˜ë£Œ**: 3.3% + VAT

---

## 5. ë³‘ëª© ì˜ˆìƒ ì§€ì 

### 5.1 AI ì´ë¯¸ì§€ ì²˜ë¦¬
- **ë³‘ëª©**: Python AI ì„œë²„ì˜ CPU/GPU ë¦¬ì†ŒìŠ¤
- **ì˜ˆìƒ ì²˜ë¦¬ ì‹œê°„**: 10-60ì´ˆ/ê±´
- **ëŒ€ì‘**:
  - RabbitMQë¡œ íì‰ (ë™ì‹œ ì²˜ë¦¬ ì œí•œ)
  - Worker ìˆ˜ ì¡°ì ˆ (í˜„ì¬ 1ê°œ)
  - í–¥í›„: GPU ì„œë²„ ì¶”ê°€, ë³‘ë ¬ ì²˜ë¦¬

### 5.2 Gemini API í˜¸ì¶œ
- **ë³‘ëª©**: API Rate Limit
- **ëŒ€ì‘**:
  - í˜¸ì¶œ ìˆ˜ ì œí•œ (1ì¼ 10íšŒ/ì‚¬ìš©ì)
  - ìºì‹± (ë™ì¼ ì¡°í•© ì¬ì‚¬ìš©)

### 5.3 ì´ë¯¸ì§€ íŒŒì¼ ì €ì¥
- **ë³‘ëª©**: ë¡œì»¬ ë””ìŠ¤í¬ ìš©ëŸ‰
- **ì˜ˆìƒ ì¦ê°€ìœ¨**: 5MB/ì˜· Ã— 1000ì˜· = 5GB
- **ëŒ€ì‘**: S3 ì „í™˜ ê³„íš

### 5.4 DB ì»¤ë„¥ì…˜
- **ë³‘ëª©**: MariaDB ë™ì‹œ ì ‘ì† ìˆ˜
- **ëŒ€ì‘**:
  - HikariCP ì»¤ë„¥ì…˜ í’€ (ê¸°ë³¸ 10ê°œ)
  - ì¿¼ë¦¬ ìµœì í™” (ì¸ë±ìŠ¤)

---

## 6. ìŠ¤ì¼€ì¼ ì‹œ ë³€í™” í¬ì¸íŠ¸

### Phase 1 (í˜„ì¬ - MVP)
- **ì„œë²„**: ë‹¨ì¼ ì„œë²„
- **DB**: ë‹¨ì¼ MariaDB
- **AI**: ë¡œì»¬ Python ì„œë²„ 1ëŒ€

### Phase 2 (ì‚¬ìš©ì 1,000ëª…)
- **ì„œë²„**: 2ëŒ€ (ë¡œë“œ ë°¸ëŸ°ì‹±)
- **DB**: Master-Slave Replication
- **AI**: GPU ì„œë²„ ì¶”ê°€
- **íŒŒì¼**: S3 ì „í™˜

### Phase 3 (ì‚¬ìš©ì 10,000ëª…+)
- **ì„œë²„**: Auto Scaling (3ëŒ€+)
- **DB**: Sharding or Cloud DB (Aurora)
- **AI**: MSA ë¶„ë¦¬, Kubernetes
- **ìºì‹œ**: Redis ì¶”ê°€

---

## 7. ë³´ì•ˆ ê³ ë ¤ì‚¬í•­

### 7.1 ì¸ì¦/ì¸ê°€
- JWT ê¸°ë°˜ Stateless ì¸ì¦
- HTTPS í†µì‹  (ë°°í¬ ì‹œ)
- CORS ì •ì±… (í—ˆìš© origin ì œí•œ)

### 7.2 íŒŒì¼ ì—…ë¡œë“œ
- íŒŒì¼ í™•ì¥ì ê²€ì¦ (JPG, PNGë§Œ í—ˆìš©)
- íŒŒì¼ í¬ê¸° ì œí•œ (5MB)
- íŒŒì¼ëª… UUID ë³€í™˜ (ê²½ë¡œ íƒìƒ‰ ë°©ì§€)

### 7.3 XSS/CSRF
- Spring Security CSRF ë¹„í™œì„±í™” (JWT ì‚¬ìš©)
- Reactì—ì„œ ì…ë ¥ ê°’ sanitization

### 7.4 API Rate Limiting
- í–¥í›„ ë„ì… ì˜ˆì • (Spring Cloud Gateway)

---

## ë³€ê²½ ì´ë ¥

| ë‚ ì§œ | ë²„ì „ | ì‘ì„±ì | ë³€ê²½ ë‚´ìš© |
|------|------|--------|-----------|
| 2024-12-30 | 1.0 | Development Team | ì´ˆê¸° ë¬¸ì„œ ì‘ì„± |
