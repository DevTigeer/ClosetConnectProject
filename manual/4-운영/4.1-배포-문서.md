# ë°°í¬ ë¬¸ì„œ

**ì‘ì„±ì¼**: 2024-12-30
**ì‘ì„±ì**: Development Team
**ë²„ì „**: 1.0

---

## ğŸ“Œ ìš”ì•½

ClosetConnect í”„ë¡œì íŠ¸ì˜ ë°°í¬ í™˜ê²½, ë°°í¬ ìˆœì„œ, ë¡¤ë°± ì „ëµ, í™˜ê²½ ë³€ìˆ˜ë¥¼ ì •ë¦¬í•©ë‹ˆë‹¤.

---

## 1. ë°°í¬ í™˜ê²½

### 1.1 ê°œë°œ í™˜ê²½ (Local)
- **Backend**: `localhost:8080`
- **Frontend**: `localhost:5173` (Vite Dev Server)
- **AI Server**: `localhost:8000` (ë°°ê²½ ì œê±°, ì„¸ê·¸ë©˜í…Œì´ì…˜)
- **AI Server**: `localhost:8001` (ì¸í˜ì¸íŒ…)
- **RabbitMQ**: `localhost:5672` (AMQP), `localhost:15672` (Management UI)
- **MariaDB**: `localhost:3306`

### 1.2 ìš´ì˜ í™˜ê²½ (Production)
- **Backend**: `https://api.closetconnect.com`
- **Frontend**: `https://closetconnect.com`
- **AI Server**: ë‚´ë¶€ ë„¤íŠ¸ì›Œí¬ (public ë…¸ì¶œ ì•ˆ í•¨)
- **RabbitMQ**: ë‚´ë¶€ ë„¤íŠ¸ì›Œí¬
- **MariaDB**: ë‚´ë¶€ ë„¤íŠ¸ì›Œí¬

---

## 2. ë°°í¬ ìˆœì„œ

### 2.1 Backend ë°°í¬

#### ì‚¬ì „ ì¤€ë¹„
1. MariaDB ì„¤ì¹˜ ë° ë°ì´í„°ë² ì´ìŠ¤ ìƒì„±
   ```sql
   CREATE DATABASE closetConnectProject;
   CREATE USER 'app_user'@'%' IDENTIFIED BY 'PASSWORD';
   GRANT ALL PRIVILEGES ON closetConnectProject.* TO 'app_user'@'%';
   ```

2. RabbitMQ ì„¤ì¹˜ ë° ì‹œì‘
   ```bash
   brew install rabbitmq
   brew services start rabbitmq
   ```

3. í™˜ê²½ ë³€ìˆ˜ ì„¤ì • (`.env` íŒŒì¼ ë˜ëŠ” ì‹œìŠ¤í…œ í™˜ê²½ ë³€ìˆ˜)
   ```bash
   export DB_URL=jdbc:mariadb://localhost:3306/closetConnectProject
   export DB_USERNAME=app_user
   export DB_PASSWORD=PASSWORD
   export JWT_SECRET=your-secret-key
   export RABBITMQ_HOST=localhost
   ```

#### ë¹Œë“œ ë° ì‹¤í–‰
```bash
# 1. ì†ŒìŠ¤ ì½”ë“œ Pull
git pull origin main

# 2. ë¹Œë“œ (í…ŒìŠ¤íŠ¸ ì œì™¸)
./gradlew build -x test

# 3. JAR íŒŒì¼ ì‹¤í–‰
java -jar build/libs/closetconnectproject-0.0.1-SNAPSHOT.jar
```

### 2.2 AI Server ë°°í¬

#### ì‚¬ì „ ì¤€ë¹„
1. Python 3.10+ ì„¤ì¹˜
2. ì˜ì¡´ì„± ì„¤ì¹˜
   ```bash
   cd aiModel
   pip install -r requirements.txt
   ```

3. Google Gemini API Key ì„¤ì •
   ```bash
   export GOOGLE_API_KEY=your-gemini-api-key
   ```

#### ì‹¤í–‰
```bash
# ë°°ê²½ ì œê±° & ì„¸ê·¸ë©˜í…Œì´ì…˜ ì„œë²„
python cloth_segmentation_api.py

# ì¸í˜ì¸íŒ… ì„œë²„
python inpainting_api.py
```

### 2.3 Frontend ë°°í¬

#### ë¹Œë“œ
```bash
cd prontend/ClosetConnectProject/frontend

# í™˜ê²½ ë³€ìˆ˜ ì„¤ì •
echo "VITE_API_BASE_URL=https://api.closetconnect.com" > .env.production

# ë¹Œë“œ
npm run build
```

#### Nginx ì„¤ì •
```nginx
server {
    listen 80;
    server_name closetconnect.com;

    root /var/www/closetconnect/dist;
    index index.html;

    # SPA ë¼ìš°íŒ…
    location / {
        try_files $uri $uri/ /index.html;
    }

    # Static files (ì´ë¯¸ì§€ ì—…ë¡œë“œ)
    location /uploads {
        alias /var/www/closetconnect/uploads;
        expires 7d;
    }

    # API Proxy
    location /api {
        proxy_pass http://localhost:8080;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
    }

    # WebSocket Proxy
    location /ws {
        proxy_pass http://localhost:8080;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection "Upgrade";
    }
}
```

---

## 3. ë¡¤ë°± ì „ëµ

### 3.1 Backend ë¡¤ë°±

#### ë°©ë²• 1: ì´ì „ JAR íŒŒì¼ ì‹¤í–‰
```bash
# í˜„ì¬ ì‹¤í–‰ ì¤‘ì¸ í”„ë¡œì„¸ìŠ¤ ì¤‘ì§€
kill -9 $(lsof -t -i:8080)

# ì´ì „ ë²„ì „ JAR ì‹¤í–‰
java -jar backups/closetconnectproject-v1.0.0.jar
```

#### ë°©ë²• 2: Git ë¡¤ë°± í›„ ì¬ë¹Œë“œ
```bash
git checkout v1.0.0
./gradlew build -x test
java -jar build/libs/closetconnectproject-0.0.1-SNAPSHOT.jar
```

### 3.2 Frontend ë¡¤ë°±

#### Nginx ë””ë ‰í† ë¦¬ êµì²´
```bash
# ë°±ì—…ë³¸ ë³µì›
cp -r /var/www/closetconnect/backups/dist-v1.0.0 /var/www/closetconnect/dist

# Nginx ì¬ì‹œì‘
sudo nginx -s reload
```

### 3.3 Database ë¡¤ë°±

#### Migration ë¡¤ë°± (Flyway ì‚¬ìš© ì‹œ)
```bash
./gradlew flywayUndo
```

#### ë°±ì—… ë³µì›
```bash
# ë°±ì—… (ë°°í¬ ì „ í•„ìˆ˜)
mysqldump -u app_user -p closetConnectProject > backup-$(date +%Y%m%d).sql

# ë³µì›
mysql -u app_user -p closetConnectProject < backup-20241230.sql
```

---

## 4. í™˜ê²½ ë³€ìˆ˜ ì •ë¦¬

### 4.1 Backend (Spring Boot)

| ë³€ìˆ˜ëª… | ì„¤ëª… | ì˜ˆì‹œ | í•„ìˆ˜ |
|--------|------|------|------|
| `DB_URL` | MariaDB ì ‘ì† URL | `jdbc:mariadb://localhost:3306/closetConnectProject` | âœ… |
| `DB_USERNAME` | DB ì‚¬ìš©ìëª… | `app_user` | âœ… |
| `DB_PASSWORD` | DB ë¹„ë°€ë²ˆí˜¸ | `password123` | âœ… |
| `JWT_SECRET` | JWT ì„œëª… í‚¤ | `my-secret-key-12345` | âœ… |
| `JWT_ACCESS_TOKEN_VALIDITY` | í† í° ìœ íš¨ ì‹œê°„ (ì´ˆ) | `3600` (1ì‹œê°„) | âŒ |
| `RABBITMQ_HOST` | RabbitMQ í˜¸ìŠ¤íŠ¸ | `localhost` | âœ… |
| `RABBITMQ_PORT` | RabbitMQ í¬íŠ¸ | `5672` | âŒ |
| `RABBITMQ_USERNAME` | RabbitMQ ì‚¬ìš©ìëª… | `guest` | âŒ |
| `RABBITMQ_PASSWORD` | RabbitMQ ë¹„ë°€ë²ˆí˜¸ | `guest` | âŒ |
| `TOSS_SECRET_KEY` | TossPayments Secret Key | `test_sk_xxx` | âœ… |

### 4.2 AI Server (Python)

| ë³€ìˆ˜ëª… | ì„¤ëª… | ì˜ˆì‹œ | í•„ìˆ˜ |
|--------|------|------|------|
| `GOOGLE_API_KEY` | Gemini API Key | `AIzaSyXXX` | âœ… |
| `RABBITMQ_HOST` | RabbitMQ í˜¸ìŠ¤íŠ¸ | `localhost` | âœ… |
| `BACKEND_BASE_URL` | Backend API URL | `http://localhost:8080` | âœ… |

### 4.3 Frontend (React)

| ë³€ìˆ˜ëª… | ì„¤ëª… | ì˜ˆì‹œ | í•„ìˆ˜ |
|--------|------|------|------|
| `VITE_API_BASE_URL` | Backend API URL | `http://localhost:8080` | âœ… |

---

## 5. ë°°í¬ ì²´í¬ë¦¬ìŠ¤íŠ¸

### ë°°í¬ ì „
- [ ] DB ë°±ì—… ì™„ë£Œ
- [ ] í™˜ê²½ ë³€ìˆ˜ í™•ì¸
- [ ] í…ŒìŠ¤íŠ¸ ì™„ë£Œ (ë˜ëŠ” ìŠ¤í‚µ)
- [ ] ë¡¤ë°± ê³„íš ìˆ˜ë¦½
- [ ] ë°°í¬ ê³µì§€ (ì‚¬ìš©ì ì•Œë¦¼)

### ë°°í¬ ì¤‘
- [ ] ì„œë¹„ìŠ¤ ì¤‘ì§€ (ë˜ëŠ” Blue-Green ë°°í¬)
- [ ] ìƒˆ ë²„ì „ ë°°í¬
- [ ] ì„œë¹„ìŠ¤ ì‹œì‘
- [ ] Health Check í™•ì¸

### ë°°í¬ í›„
- [ ] ì£¼ìš” ê¸°ëŠ¥ ë™ì‘ í™•ì¸
- [ ] ì—ëŸ¬ ë¡œê·¸ ëª¨ë‹ˆí„°ë§
- [ ] ì„±ëŠ¥ ì§€í‘œ í™•ì¸
- [ ] ë°°í¬ ì™„ë£Œ ê³µì§€

---

## 6. Blue-Green ë°°í¬ (í–¥í›„)

### ê°œë…
- **Blue**: í˜„ì¬ ìš´ì˜ ì¤‘ì¸ í™˜ê²½
- **Green**: ìƒˆë¡œ ë°°í¬í•  í™˜ê²½

### ì ˆì°¨
1. Green í™˜ê²½ì— ìƒˆ ë²„ì „ ë°°í¬
2. Health Check í†µê³¼ í™•ì¸
3. ë¡œë“œ ë°¸ëŸ°ì„œ íŠ¸ë˜í”½ì„ Greenìœ¼ë¡œ ì „í™˜
4. Blue í™˜ê²½ ì¢…ë£Œ ë˜ëŠ” ë¡¤ë°± ëŒ€ê¸°

---

## ë³€ê²½ ì´ë ¥

| ë‚ ì§œ | ë²„ì „ | ì‘ì„±ì | ë³€ê²½ ë‚´ìš© |
|------|------|--------|-----------|
| 2024-12-30 | 1.0 | Development Team | ì´ˆê¸° ë¬¸ì„œ ì‘ì„± |
